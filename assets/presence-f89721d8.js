var ue=Object.defineProperty;var de=(e,t,s)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var k=(e,t,s)=>(de(e,typeof t!="symbol"?t+"":t,s),s);import{r as m,aJ as fe,bb as he,bc as N,bd as O,j as C,aI as me,$ as v,be as _,Z as G,Y as J,_ as x,P as pe,bf as ge,a1 as K,a2 as j,a3 as be,a7 as X,a6 as M,u as ye,bg as ve,bh as we,bi as I,bj as U,bk as S,bl as Ce,bm as Ee,bn as H,bo as L,bp as z,bq as P,br as Y,bs as B,bt as $,bu as ke}from"./index-fc0e3f91.js";function q(e){return e.substring(2).toLowerCase()}function Pe(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}function Re(e){const{children:t,disableReactTree:s=!1,mouseEvent:n="onClick",onClickAway:o,touchEvent:a="onTouchEnd"}=e,u=m.useRef(!1),r=m.useRef(null),c=m.useRef(!1),f=m.useRef(!1);m.useEffect(()=>(setTimeout(()=>{c.current=!0},0),()=>{c.current=!1}),[]);const p=fe(he(t),r),h=N(d=>{const g=f.current;f.current=!1;const y=O(r.current);if(!c.current||!r.current||"clientX"in d&&Pe(d,y))return;if(u.current){u.current=!1;return}let i;d.composedPath?i=d.composedPath().indexOf(r.current)>-1:i=!y.documentElement.contains(d.target)||r.current.contains(d.target),!i&&(s||!g)&&o(d)}),w=d=>g=>{f.current=!0;const y=t.props[d];y&&y(g)},E={ref:p};return a!==!1&&(E[a]=w(a)),m.useEffect(()=>{if(a!==!1){const d=q(a),g=O(r.current),y=()=>{u.current=!0};return g.addEventListener(d,h),g.addEventListener("touchmove",y),()=>{g.removeEventListener(d,h),g.removeEventListener("touchmove",y)}}},[h,a]),n!==!1&&(E[n]=w(n)),m.useEffect(()=>{if(n!==!1){const d=q(n),g=O(r.current);return g.addEventListener(d,h),()=>{g.removeEventListener(d,h)}}},[h,n]),C.jsx(m.Fragment,{children:m.cloneElement(t,E)})}function Me(e={}){const{autoHideDuration:t=null,disableWindowBlurListener:s=!1,onClose:n,open:o,resumeHideDuration:a}=e,u=me();m.useEffect(()=>{if(!o)return;function i(l){l.defaultPrevented||(l.key==="Escape"||l.key==="Esc")&&(n==null||n(l,"escapeKeyDown"))}return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[o,n]);const r=N((i,l)=>{n==null||n(i,l)}),c=N(i=>{!n||i==null||u.start(i,()=>{r(null,"timeout")})});m.useEffect(()=>(o&&c(t),u.clear),[o,t,c,u]);const f=i=>{n==null||n(i,"clickaway")},p=u.clear,h=m.useCallback(()=>{t!=null&&c(a??t*.5)},[t,a,c]),w=i=>l=>{const b=i.onBlur;b==null||b(l),h()},E=i=>l=>{const b=i.onFocus;b==null||b(l),p()},d=i=>l=>{const b=i.onMouseEnter;b==null||b(l),p()},g=i=>l=>{const b=i.onMouseLeave;b==null||b(l),h()};return m.useEffect(()=>{if(!s&&o)return window.addEventListener("focus",h),window.addEventListener("blur",p),()=>{window.removeEventListener("focus",h),window.removeEventListener("blur",p)}},[s,o,h,p]),{getRootProps:(i={})=>{const l=v({},_(e),_(i));return v({role:"presentation"},i,l,{onBlur:w(l),onFocus:E(l),onMouseEnter:d(l),onMouseLeave:g(l)})},onClickAway:f}}function Se(e){return G("MuiSnackbarContent",e)}J("MuiSnackbarContent",["root","message","action"]);const xe=["action","className","message","role"],Le=e=>{const{classes:t}=e;return X({root:["root"],action:["action"],message:["message"]},Se,t)},Te=x(pe,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t=e.palette.mode==="light"?.8:.98,s=ge(e.palette.background.default,t);return v({},e.typography.body2,{color:e.vars?e.vars.palette.SnackbarContent.color:e.palette.getContrastText(s),backgroundColor:e.vars?e.vars.palette.SnackbarContent.bg:s,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(e.vars||e).shape.borderRadius,flexGrow:1,[e.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}})}),Ae=x("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(e,t)=>t.message})({padding:"8px 0"}),De=x("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(e,t)=>t.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),Oe=m.forwardRef(function(t,s){const n=K({props:t,name:"MuiSnackbarContent"}),{action:o,className:a,message:u,role:r="alert"}=n,c=j(n,xe),f=n,p=Le(f);return C.jsxs(Te,v({role:r,square:!0,elevation:6,className:be(p.root,a),ownerState:f,ref:s},c,{children:[C.jsx(Ae,{className:p.message,ownerState:f,children:u}),o?C.jsx(De,{className:p.action,ownerState:f,children:o}):null]}))}),Ne=Oe;function je(e){return G("MuiSnackbar",e)}J("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const He=["onEnter","onExited"],Ie=["action","anchorOrigin","autoHideDuration","children","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onBlur","onClose","onFocus","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"],Ue=e=>{const{classes:t,anchorOrigin:s}=e,n={root:["root",`anchorOrigin${M(s.vertical)}${M(s.horizontal)}`]};return X(n,je,t)},Q=x("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,t[`anchorOrigin${M(s.anchorOrigin.vertical)}${M(s.anchorOrigin.horizontal)}`]]}})(({theme:e,ownerState:t})=>{const s={left:"50%",right:"auto",transform:"translateX(-50%)"};return v({zIndex:(e.vars||e).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},t.anchorOrigin.vertical==="top"?{top:8}:{bottom:8},t.anchorOrigin.horizontal==="left"&&{justifyContent:"flex-start"},t.anchorOrigin.horizontal==="right"&&{justifyContent:"flex-end"},{[e.breakpoints.up("sm")]:v({},t.anchorOrigin.vertical==="top"?{top:24}:{bottom:24},t.anchorOrigin.horizontal==="center"&&s,t.anchorOrigin.horizontal==="left"&&{left:24,right:"auto"},t.anchorOrigin.horizontal==="right"&&{right:24,left:"auto"})})}),ze=m.forwardRef(function(t,s){const n=K({props:t,name:"MuiSnackbar"}),o=ye(),a={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{action:u,anchorOrigin:{vertical:r,horizontal:c}={vertical:"bottom",horizontal:"left"},autoHideDuration:f=null,children:p,className:h,ClickAwayListenerProps:w,ContentProps:E,disableWindowBlurListener:d=!1,message:g,open:y,TransitionComponent:i=we,transitionDuration:l=a,TransitionProps:{onEnter:b,onExited:F}={}}=n,ee=j(n.TransitionProps,He),te=j(n,Ie),A=v({},n,{anchorOrigin:{vertical:r,horizontal:c},autoHideDuration:f,disableWindowBlurListener:d,TransitionComponent:i,transitionDuration:l}),ne=Ue(A),{getRootProps:se,onClickAway:oe}=Me(v({},A)),[re,W]=m.useState(!0),ae=ve({elementType:Q,getSlotProps:se,externalForwardedProps:te,ownerState:A,additionalProps:{ref:s},className:[ne.root,h]}),ie=D=>{W(!0),F&&F(D)},ce=(D,le)=>{W(!1),b&&b(D,le)};return!y&&re?null:C.jsx(Re,v({onClickAway:oe},w,{children:C.jsx(Q,v({},ae,{children:C.jsx(i,v({appear:!0,in:y,timeout:l,direction:r==="top"?"down":"up",onEnter:ce,onExited:ie},ee,{children:p||C.jsx(Ne,v({message:g,action:u},E))}))}))}))}),_e=ze,T=I(U,"dailyChat"),R=I(U,"chatReactions"),qe=async(e,t,s="text")=>{var n;if(!e||!t.trim())return{success:!1,message:"메시지 내용이 필요합니다."};try{const o={content:t.trim(),userEmail:e.email??"",userDisplayName:e.displayName??((n=e.email)==null?void 0:n.split("@")[0])??"Anonymous",userPhotoURL:e.photoURL??void 0,createdAt:L(),type:s,reactions:[]};return await z(T,o),{success:!0,message:"메시지가 전송되었습니다!"}}catch(o){return console.error("메시지 전송 실패:",o),{success:!1,message:"메시지 전송 중 오류가 발생했습니다."}}},Qe=async e=>{try{const t={content:e,userEmail:"system",userDisplayName:"시스템",createdAt:L(),type:"system",reactions:[]};return await z(T,t),{success:!0}}catch(t){return console.error("시스템 메시지 전송 실패:",t),{success:!1}}},Ge=(e,t=50)=>{const s=S(T,Ee("createdAt","desc"),Ce(t));let n=[];const o=H(s,async r=>{const c=[];r.forEach(f=>{c.push({id:f.id,...f.data()})}),n=c,await u()},r=>{console.error("채팅 메시지 구독 실패:",r),e([])}),a=H(R,async()=>{await u()},r=>{console.error("채팅 반응 구독 실패:",r)}),u=async()=>{try{const r=await Promise.all(n.map(async c=>{if(!c.id)return c;const f=S(R,P("messageId","==",c.id)),p=await Y(f),h=[];return p.forEach(w=>{h.push(w.data())}),{...c,reactions:h}}));r.reverse(),e(r)}catch(r){console.error("반응 데이터 로드 실패:",r),e(n.reverse())}};return()=>{o(),a()}},Je=async(e,t,s)=>{var n;if(!e)return{success:!1,message:"로그인이 필요합니다."};try{const o=S(R,P("messageId","==",t),P("userEmail","==",e.email),P("emoji","==",s)),a=await Y(o);if(a.empty)return await z(R,{messageId:t,emoji:s,userEmail:e.email,userDisplayName:e.displayName??((n=e.email)==null?void 0:n.split("@")[0])??"Anonymous",createdAt:L()}),{success:!0,message:"반응을 추가했습니다!"};{const u=a.docs[0];return await B($(R,u.id)),{success:!0,message:"반응을 제거했습니다!"}}}catch(o){return console.error("반응 토글 실패:",o),{success:!1,message:"반응 처리 중 오류가 발생했습니다."}}},Ke=async(e,t)=>{if(!e)return{success:!1,message:"로그인이 필요합니다."};try{return await B($(T,t)),{success:!0,message:"메시지가 삭제되었습니다."}}catch(s){return console.error("메시지 삭제 실패:",s),{success:!1,message:"메시지 삭제 중 오류가 발생했습니다."}}},Xe=e=>{const t=new Date,s=new Date(t.getTime()-60*60*1e3),n=new Set;let o=0;const a={};e.forEach(r=>{if(!r.createdAt)return;r.createdAt.toDate()>s&&(n.add(r.userEmail),o++),r.type==="emoji"&&(a[r.content]=(a[r.content]??0)+1)});const u=Object.entries(a).map(([r,c])=>({emoji:r,count:c})).sort((r,c)=>c.count-r.count).slice(0,5);return{totalMessages:e.length,activeUsers:n.size,messagesThisHour:o,topEmojis:u}},Ye=["😀","😂","🥰","😍","🤔","👍","👎","❤️","🔥","✨","🎉","👏","🙌","💪","🤝","🙏","😴","☕","🍕","🎯"],Ze=e=>{const t=["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722","#795548","#9e9e9e","#607d8b"];let s=0;for(let n=0;n<e.length;n++)s=e.charCodeAt(n)+((s<<5)-s);return t[Math.abs(s)%t.length]},Ve=e=>{if(!e)return"시간 정보 없음";const t=new Date,s=e.toDate(),n=t.getTime()-s.getTime(),o=Math.floor(n/6e4),a=Math.floor(o/60),u=Math.floor(a/24);return o<1?"방금 전":o<60?`${o}분 전`:a<24?`${a}시간 전`:u<7?`${u}일 전`:s.toLocaleDateString("ko-KR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},et=(e,t)=>{if(!t.trim())return e;const s=t.toLowerCase();return e.filter(n=>n.content.toLowerCase().includes(s)||n.userDisplayName.toLowerCase().includes(s))},tt=async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.warn("이 브라우저는 알림을 지원하지 않습니다."),!1),nt=(e,t)=>{e.userEmail!==t.email&&e.type!=="system"&&Notification.permission==="granted"&&document.hidden&&new Notification(`💬 ${e.userDisplayName}`,{body:e.content,icon:e.userPhotoURL??"/favicon.ico",tag:"daily-chat"})},Z=I(U,"presence"),V=async(e,t,s)=>{var o;if(!e)return;const n=$(Z,e.uid);try{t==="offline"?await B(n):await ke(n,{uid:e.uid,email:e.email,displayName:e.displayName??((o=e.email)==null?void 0:o.split("@")[0])??"Anonymous",photoURL:e.photoURL,lastSeen:L(),status:t,page:s},{merge:!0})}catch(a){console.error("Presence 업데이트 실패:",a)}},st=e=>{const t=S(Z,P("status","in",["online","away"]));return H(t,s=>{const n=[];s.forEach(o=>{const a=o.data();n.push(a)}),n.sort((o,a)=>!o.lastSeen||!a.lastSeen?0:a.lastSeen.toMillis()-o.lastSeen.toMillis()),e(n,n.length)},s=>{console.error("온라인 사용자 구독 실패:",s),e([],0)})},Be=async e=>{e&&await V(e,"offline")};class $e{constructor(){k(this,"user",null);k(this,"currentPage","");k(this,"heartbeatInterval",null);k(this,"awayTimeout",null);k(this,"isActive",!0);this.setupActivityListeners()}setUser(t){this.user&&this.user.uid!==(t==null?void 0:t.uid)&&this.cleanup(),this.user=t,t&&(this.startHeartbeat(),this.updatePresence("online"))}setCurrentPage(t){this.currentPage=t,this.user&&this.updatePresence(this.isActive?"online":"away")}startHeartbeat(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval(()=>{this.user&&this.updatePresence(this.isActive?"online":"away")},3e4)}setupActivityListeners(){const t=["mousedown","mousemove","keypress","scroll","touchstart","click"],s=()=>{this.isActive=!0,this.awayTimeout&&clearTimeout(this.awayTimeout),this.awayTimeout=setTimeout(()=>{this.isActive=!1,this.user&&this.updatePresence("away")},3e5),this.user&&this.updatePresence("online")};t.forEach(n=>{document.addEventListener(n,s,!0)}),document.addEventListener("visibilitychange",()=>{document.hidden?(this.isActive=!1,this.user&&this.updatePresence("away")):(this.isActive=!0,this.user&&this.updatePresence("online"))}),window.addEventListener("beforeunload",()=>{this.user&&navigator.sendBeacon("/api/presence/offline",JSON.stringify({uid:this.user.uid}))})}updatePresence(t){this.user&&V(this.user,t,this.currentPage)}cleanup(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.awayTimeout&&(clearTimeout(this.awayTimeout),this.awayTimeout=null),this.user&&Be(this.user)}}const ot=new $e;export{Ye as P,_e as S,st as a,et as b,Qe as c,Xe as d,Ze as e,Ve as f,ot as g,nt as h,qe as i,Ke as j,tt as r,Ge as s,Je as t};
