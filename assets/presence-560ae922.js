var L=Object.defineProperty;var C=(e,t,s)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var u=(e,t,s)=>(C(e,typeof t!="symbol"?t+"":t,s),s);import{E as g,F as w,G as d,H as R,I,J as p,K as m,L as v,M as l,N as A,O as b,P,Q as S}from"./index-bf293548.js";const y=g(w,"dailyChat"),h=g(w,"chatReactions"),Q=async(e,t,s="text")=>{var a;if(!e||!t.trim())return{success:!1,message:"ë©”ì‹œì§€ ë‚´ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤."};try{const i={content:t.trim(),userEmail:e.email??"",userDisplayName:e.displayName??((a=e.email)==null?void 0:a.split("@")[0])??"Anonymous",userPhotoURL:e.photoURL??void 0,createdAt:m(),type:s,reactions:[]};return await v(y,i),{success:!0,message:"ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!"}}catch(i){return console.error("ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:",i),{success:!1,message:"ë©”ì‹œì§€ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}}},$=async e=>{try{const t={content:e,userEmail:"system",userDisplayName:"ì‹œìŠ¤í…œ",createdAt:m(),type:"system",reactions:[]};return await v(y,t),{success:!0}}catch(t){return console.error("ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:",t),{success:!1}}},q=(e,t=50)=>{const s=d(y,I("createdAt","desc"),R(t));let a=[];const i=p(s,async r=>{const o=[];r.forEach(f=>{o.push({id:f.id,...f.data()})}),a=o,await c()},r=>{console.error("ì±„íŒ… ë©”ì‹œì§€ êµ¬ë… ì‹¤íŒ¨:",r),e([])}),n=p(h,async()=>{await c()},r=>{console.error("ì±„íŒ… ë°˜ì‘ êµ¬ë… ì‹¤íŒ¨:",r)}),c=async()=>{try{const r=await Promise.all(a.map(async o=>{if(!o.id)return o;const f=d(h,l("messageId","==",o.id)),D=await A(f),M=[];return D.forEach(E=>{M.push(E.data())}),{...o,reactions:M}}));r.reverse(),e(r)}catch(r){console.error("ë°˜ì‘ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",r),e(a.reverse())}};return()=>{i(),n()}},x=async(e,t,s)=>{var a;if(!e)return{success:!1,message:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."};try{const i=d(h,l("messageId","==",t),l("userEmail","==",e.email),l("emoji","==",s)),n=await A(i);if(n.empty)return await v(h,{messageId:t,emoji:s,userEmail:e.email,userDisplayName:e.displayName??((a=e.email)==null?void 0:a.split("@")[0])??"Anonymous",createdAt:m()}),{success:!0,message:"ë°˜ì‘ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤!"};{const c=n.docs[0];return await b(P(h,c.id)),{success:!0,message:"ë°˜ì‘ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤!"}}}catch(i){return console.error("ë°˜ì‘ í† ê¸€ ì‹¤íŒ¨:",i),{success:!1,message:"ë°˜ì‘ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}}},J=async(e,t)=>{if(!e)return{success:!1,message:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."};try{return await b(P(y,t)),{success:!0,message:"ë©”ì‹œì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."}}catch(s){return console.error("ë©”ì‹œì§€ ì‚­ì œ ì‹¤íŒ¨:",s),{success:!1,message:"ë©”ì‹œì§€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}}},B=e=>{const t=new Date,s=new Date(t.getTime()-60*60*1e3),a=new Set;let i=0;const n={};e.forEach(r=>{if(!r.createdAt)return;r.createdAt.toDate()>s&&(a.add(r.userEmail),i++),r.type==="emoji"&&(n[r.content]=(n[r.content]??0)+1)});const c=Object.entries(n).map(([r,o])=>({emoji:r,count:o})).sort((r,o)=>o.count-r.count).slice(0,5);return{totalMessages:e.length,activeUsers:a.size,messagesThisHour:i,topEmojis:c}},F=["ğŸ˜€","ğŸ˜‚","ğŸ¥°","ğŸ˜","ğŸ¤”","ğŸ‘","ğŸ‘","â¤ï¸","ğŸ”¥","âœ¨","ğŸ‰","ğŸ‘","ğŸ™Œ","ğŸ’ª","ğŸ¤","ğŸ™","ğŸ˜´","â˜•","ğŸ•","ğŸ¯"],K=e=>{const t=["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722","#795548","#9e9e9e","#607d8b"];let s=0;for(let a=0;a<e.length;a++)s=e.charCodeAt(a)+((s<<5)-s);return t[Math.abs(s)%t.length]},z=e=>{if(!e)return"ì‹œê°„ ì •ë³´ ì—†ìŒ";const t=new Date,s=e.toDate(),a=t.getTime()-s.getTime(),i=Math.floor(a/6e4),n=Math.floor(i/60),c=Math.floor(n/24);return i<1?"ë°©ê¸ˆ ì „":i<60?`${i}ë¶„ ì „`:n<24?`${n}ì‹œê°„ ì „`:c<7?`${c}ì¼ ì „`:s.toLocaleDateString("ko-KR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},G=(e,t)=>{if(!t.trim())return e;const s=t.toLowerCase();return e.filter(a=>a.content.toLowerCase().includes(s)||a.userDisplayName.toLowerCase().includes(s))},W=async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.warn("ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."),!1),_=(e,t)=>{e.userEmail!==t.email&&e.type!=="system"&&Notification.permission==="granted"&&document.hidden&&new Notification(`ğŸ’¬ ${e.userDisplayName}`,{body:e.content,icon:e.userPhotoURL??"/favicon.ico",tag:"daily-chat"})},T=g(w,"presence"),N=async(e,t,s)=>{var i;if(!e)return;const a=P(T,e.uid);try{t==="offline"?await b(a):await S(a,{uid:e.uid,email:e.email,displayName:e.displayName??((i=e.email)==null?void 0:i.split("@")[0])??"Anonymous",photoURL:e.photoURL,lastSeen:m(),status:t,page:s},{merge:!0})}catch(n){console.error("Presence ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",n)}},k=e=>{const t=d(T,l("status","in",["online","away"]));return p(t,s=>{const a=[];s.forEach(i=>{const n=i.data();a.push(n)}),a.sort((i,n)=>!i.lastSeen||!n.lastSeen?0:n.lastSeen.toMillis()-i.lastSeen.toMillis()),e(a,a.length)},s=>{console.error("ì˜¨ë¼ì¸ ì‚¬ìš©ì êµ¬ë… ì‹¤íŒ¨:",s),e([],0)})},U=async e=>{e&&await N(e,"offline")};class H{constructor(){u(this,"user",null);u(this,"currentPage","");u(this,"heartbeatInterval",null);u(this,"awayTimeout",null);u(this,"isActive",!0);this.setupActivityListeners()}setUser(t){this.user&&this.user.uid!==(t==null?void 0:t.uid)&&this.cleanup(),this.user=t,t&&(this.startHeartbeat(),this.updatePresence("online"))}setCurrentPage(t){this.currentPage=t,this.user&&this.updatePresence(this.isActive?"online":"away")}startHeartbeat(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval(()=>{this.user&&this.updatePresence(this.isActive?"online":"away")},3e4)}setupActivityListeners(){const t=["mousedown","mousemove","keypress","scroll","touchstart","click"],s=()=>{this.isActive=!0,this.awayTimeout&&clearTimeout(this.awayTimeout),this.awayTimeout=setTimeout(()=>{this.isActive=!1,this.user&&this.updatePresence("away")},3e5),this.user&&this.updatePresence("online")};t.forEach(a=>{document.addEventListener(a,s,!0)}),document.addEventListener("visibilitychange",()=>{document.hidden?(this.isActive=!1,this.user&&this.updatePresence("away")):(this.isActive=!0,this.user&&this.updatePresence("online"))}),window.addEventListener("beforeunload",()=>{this.user&&navigator.sendBeacon("/api/presence/offline",JSON.stringify({uid:this.user.uid}))})}updatePresence(t){this.user&&N(this.user,t,this.currentPage)}cleanup(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.awayTimeout&&(clearTimeout(this.awayTimeout),this.awayTimeout=null),this.user&&U(this.user)}}const V=new H;export{F as P,k as a,G as b,$ as c,B as d,K as e,z as f,V as g,_ as h,Q as i,J as j,W as r,q as s,x as t};
