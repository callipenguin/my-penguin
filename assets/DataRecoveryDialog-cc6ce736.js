import{a as g,j as s,D as ls,b as ds,B as i,aC as I,c as xs,A as F,a6 as j,a7 as p,T as a,C as $,ao as hs,a_ as js,a$ as k,aB as R,bH as ps,f as d,az as _,be as z,bf as G,b6 as H,bg as L,aL as fs,aA as N,bI as O,aH as us,aI as gs,aE as V,e as ms}from"./mui-f5b39a97.js";import{a as ys,V as bs,W as Ss,X as vs,Y as Cs,Z as Is}from"./index-16e83210.js";import{r as Ns,g as Os,e as Js,a as $s,i as ks,b as Es}from"./Dashboard-0b26b6b9.js";import"./dayjs-9d6a636c.js";const As=({open:J,onClose:E,onDataRecovered:m})=>{var P,U,w;const[x,X]=g.useState(null),[D,Y]=g.useState(!1),[W,r]=g.useState(""),[Z,o]=g.useState("info"),[b,q]=g.useState(0),[h,K]=g.useState(!1),{todos:S,epics:v,projects:C,addTodo:B,addEpic:T,addProject:A}=ys();g.useEffect(()=>{J&&(f(),M())},[J]);const f=()=>{const e=bs();X(e)},M=()=>{const e=localStorage.getItem("data_backup");Y(!!e)},Q=()=>{try{const e=Ss();r(`데이터 백업 완료! (${e.todos.length}개 할일, ${e.epics.length}개 에픽, ${e.projects.length}개 프로젝트)`),o("success"),M()}catch{r("백업 중 오류가 발생했습니다."),o("error")}},ss=()=>{try{const e=vs();e?(r(`데이터 복구 완료! (${e.todos.length}개 할일, ${e.epics.length}개 에픽, ${e.projects.length}개 프로젝트)`),o("success"),f(),m()):(r("복구할 백업 데이터가 없습니다."),o("error"))}catch{r("복구 중 오류가 발생했습니다."),o("error")}},es=()=>{try{const e=Cs();r("스마트 복구 완료! 기본 데이터로 설정했습니다."),o("success"),f(),m()}catch{r("스마트 복구 중 오류가 발생했습니다."),o("error")}},rs=()=>{try{Ns()?(r("실제 데이터 복구 완료! (지급결의사이트 리뉴얼 프로젝트 포함)"),o("success"),f(),m()):(r("실제 데이터 복구에 실패했습니다."),o("error"))}catch{r("실제 데이터 복구 중 오류가 발생했습니다."),o("error")}},ts=()=>{try{Os(),r("사용자 데이터 JSON 파일 생성 완료!"),o("success")}catch{r("사용자 데이터 JSON 생성에 실패했습니다."),o("error")}},os=()=>{if(confirm("정말로 모든 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{Is(),r("모든 데이터가 삭제되었습니다."),o("info"),f(),m()}catch{r("데이터 삭제 중 오류가 발생했습니다."),o("error")}},as=()=>{try{const e=Js(S,v,C);r(`엑셀 파일 내보내기 완료! (${e})`),o("success")}catch{r("엑셀 내보내기 중 오류가 발생했습니다."),o("error")}},cs=()=>{try{const e=$s(S,v,C);r("JSON 파일 내보내기 완료! (통계 포함)"),o("success")}catch{r("JSON 내보내기 중 오류가 발생했습니다."),o("error")}},is=async e=>{var y;const u=(y=e.target.files)==null?void 0:y[0];if(u)try{const t=await ks(u);if(h){let n={todos:0,epics:0,projects:0};t.epics.forEach(c=>{v.find(l=>l.id===c.id)||(T(c),n.epics++)}),t.projects.forEach(c=>{C.find(l=>l.id===c.id)||(A(c),n.projects++)}),t.todos.forEach(c=>{S.find(l=>l.id===c.id)||(B(c),n.todos++)}),r(`엑셀 데이터 추가 완료! (${n.todos}개 할일, ${n.epics}개 에픽, ${n.projects}개 프로젝트 추가)`)}else localStorage.setItem("todos",JSON.stringify(t.todos)),localStorage.setItem("epics",JSON.stringify(t.epics)),localStorage.setItem("projects",JSON.stringify(t.projects)),r(`엑셀 데이터 가져오기 완료! (${t.todos.length}개 할일, ${t.epics.length}개 에픽, ${t.projects.length}개 프로젝트)`);o("success"),f(),m()}catch(t){r(`엑셀 가져오기 실패: ${t}`),o("error")}e.target.value=""},ns=async e=>{var y;const u=(y=e.target.files)==null?void 0:y[0];if(u)try{const t=await Es(u);if(h){let n={todos:0,epics:0,projects:0};t.epics.forEach(c=>{v.find(l=>l.id===c.id)||(T(c),n.epics++)}),t.projects.forEach(c=>{C.find(l=>l.id===c.id)||(A(c),n.projects++)}),t.todos.forEach(c=>{S.find(l=>l.id===c.id)||(B(c),n.todos++)}),r(`JSON 데이터 추가 완료! (${n.todos}개 할일, ${n.epics}개 에픽, ${n.projects}개 프로젝트 추가)`)}else localStorage.setItem("todos",JSON.stringify(t.todos)),localStorage.setItem("epics",JSON.stringify(t.epics)),localStorage.setItem("projects",JSON.stringify(t.projects)),r(`JSON 데이터 가져오기 완료! (${t.todos.length}개 할일, ${t.epics.length}개 에픽, ${t.projects.length}개 프로젝트)`);o("success"),f(),m()}catch(t){r(`JSON 가져오기 실패: ${t}`),o("error")}e.target.value=""};return s.jsxs(ls,{open:J,onClose:E,maxWidth:"md",fullWidth:!0,children:[s.jsx(ds,{children:s.jsxs(i,{display:"flex",alignItems:"center",gap:1,children:[s.jsx(I,{color:"primary"}),"데이터 관리 센터 🛠️"]})}),s.jsxs(xs,{children:[W&&s.jsx(F,{severity:Z,sx:{mb:2},onClose:()=>r(""),children:W}),s.jsx(j,{sx:{mb:3},children:s.jsxs(p,{children:[s.jsx(a,{variant:"h6",gutterBottom:!0,children:"📊 현재 데이터 상태"}),s.jsxs(i,{display:"flex",gap:2,flexWrap:"wrap",children:[s.jsx($,{label:`할일: ${((P=x==null?void 0:x.todos)==null?void 0:P.length)||0}개`,color:"primary"}),s.jsx($,{label:`에픽: ${((U=x==null?void 0:x.epics)==null?void 0:U.length)||0}개`,color:"secondary"}),s.jsx($,{label:`프로젝트: ${((w=x==null?void 0:x.projects)==null?void 0:w.length)||0}개`,color:"info"})]})]})}),s.jsx(hs,{sx:{mb:3},children:s.jsxs(js,{value:b,onChange:(e,u)=>q(u),variant:"fullWidth",children:[s.jsx(k,{icon:s.jsx(I,{}),label:"복구",iconPosition:"start"}),s.jsx(k,{icon:s.jsx(R,{}),label:"내보내기",iconPosition:"start"}),s.jsx(k,{icon:s.jsx(ps,{}),label:"가져오기",iconPosition:"start"})]})}),b===0&&s.jsxs(i,{children:[s.jsx(j,{sx:{mb:3,border:"2px solid",borderColor:"error.main"},children:s.jsxs(p,{children:[s.jsx(a,{variant:"h6",gutterBottom:!0,color:"error",children:"🆘 실제 데이터 복구 (긴급)"}),s.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"시스템 업데이트로 인해 손실된 '지급결의사이트 리뉴얼' 프로젝트를 포함한 실제 데이터를 복구합니다."}),s.jsx(d,{variant:"contained",color:"error",onClick:rs,startIcon:s.jsx(_,{}),fullWidth:!0,sx:{mb:1},children:"내 실제 데이터 복구하기"}),s.jsx(d,{variant:"outlined",color:"error",onClick:ts,startIcon:s.jsx(R,{}),fullWidth:!0,size:"small",children:"내 데이터 JSON으로 다운로드"})]})}),s.jsx(j,{sx:{mb:3},children:s.jsxs(p,{children:[s.jsx(a,{variant:"h6",gutterBottom:!0,color:"primary",children:"🚀 빠른 복구 (추천)"}),s.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"데이터가 사라졌거나 샘플 데이터로 덮어써진 경우, 기본 사용자 데이터로 복구합니다."}),s.jsx(d,{variant:"contained",color:"primary",onClick:es,startIcon:s.jsx(I,{}),fullWidth:!0,children:"스마트 복구 실행"})]})}),s.jsxs(z,{children:[s.jsx(G,{expandIcon:s.jsx(H,{}),children:s.jsx(a,{variant:"h6",children:"🔄 백업 및 복구"})}),s.jsx(L,{children:s.jsxs(i,{display:"flex",flexDirection:"column",gap:2,children:[s.jsx(d,{variant:"outlined",onClick:Q,startIcon:s.jsx(_,{}),fullWidth:!0,children:"현재 데이터 백업하기"}),s.jsxs(d,{variant:"outlined",onClick:ss,startIcon:s.jsx(I,{}),disabled:!D,fullWidth:!0,children:["백업에서 복구하기 ",!D&&"(백업 없음)"]})]})})]}),s.jsxs(z,{children:[s.jsx(G,{expandIcon:s.jsx(H,{}),children:s.jsx(a,{variant:"h6",color:"error",children:"⚠️ 위험한 작업"})}),s.jsx(L,{children:s.jsx(d,{variant:"outlined",color:"error",onClick:os,startIcon:s.jsx(fs,{}),fullWidth:!0,children:"모든 데이터 삭제"})})]})]}),b===1&&s.jsxs(i,{children:[s.jsx(a,{variant:"h6",gutterBottom:!0,sx:{mb:3},children:"📤 데이터 내보내기"}),s.jsxs(i,{display:"flex",flexDirection:"column",gap:2,children:[s.jsx(j,{children:s.jsxs(p,{children:[s.jsxs(i,{display:"flex",alignItems:"center",gap:2,mb:2,children:[s.jsx(N,{color:"success"}),s.jsxs(i,{flex:1,children:[s.jsx(a,{variant:"h6",children:"엑셀 파일 (.xlsx)"}),s.jsx(a,{variant:"body2",color:"text.secondary",children:"할일, 에픽, 프로젝트를 각각 시트로 분리하여 엑셀 파일로 내보냅니다."})]})]}),s.jsx(d,{variant:"contained",color:"success",onClick:as,startIcon:s.jsx(N,{}),fullWidth:!0,children:"엑셀 파일로 내보내기"})]})}),s.jsx(j,{children:s.jsxs(p,{children:[s.jsxs(i,{display:"flex",alignItems:"center",gap:2,mb:2,children:[s.jsx(O,{color:"info"}),s.jsxs(i,{flex:1,children:[s.jsx(a,{variant:"h6",children:"JSON 파일 (.json)"}),s.jsx(a,{variant:"body2",color:"text.secondary",children:"모든 데이터와 통계 정보를 포함한 JSON 파일로 내보냅니다."})]})]}),s.jsx(d,{variant:"contained",color:"info",onClick:cs,startIcon:s.jsx(O,{}),fullWidth:!0,children:"JSON 파일로 내보내기"})]})})]})]}),b===2&&s.jsxs(i,{children:[s.jsx(a,{variant:"h6",gutterBottom:!0,sx:{mb:2},children:"📥 데이터 가져오기"}),s.jsx(j,{sx:{mb:3},children:s.jsxs(p,{children:[s.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"📋 가져오기 모드 설정"}),s.jsx(us,{control:s.jsx(gs,{checked:h,onChange:e=>K(e.target.checked),color:"primary"}),label:s.jsxs(i,{children:[s.jsx(a,{variant:"body2",children:h?"🔀 추가 모드":"🔄 교체 모드"}),s.jsx(a,{variant:"caption",color:"text.secondary",children:h?"기존 데이터에 새 데이터를 추가합니다 (중복 제외)":"기존 데이터를 완전히 교체합니다"})]})})]})}),s.jsxs(i,{display:"flex",flexDirection:"column",gap:2,children:[s.jsx(j,{children:s.jsxs(p,{children:[s.jsxs(i,{display:"flex",alignItems:"center",gap:2,mb:2,children:[s.jsx(N,{color:"success"}),s.jsxs(i,{flex:1,children:[s.jsx(a,{variant:"h6",children:"엑셀 파일 가져오기"}),s.jsx(a,{variant:"body2",color:"text.secondary",children:"엑셀 파일(.xlsx)에서 데이터를 가져옵니다. '할일', '에픽', '프로젝트' 시트를 인식합니다."})]})]}),s.jsxs(d,{variant:"contained",color:"success",component:"label",startIcon:h?s.jsx(V,{}):s.jsx(N,{}),fullWidth:!0,children:[h?"엑셀 데이터 추가하기":"엑셀 파일 가져오기",s.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:is,style:{display:"none"}})]})]})}),s.jsx(j,{children:s.jsxs(p,{children:[s.jsxs(i,{display:"flex",alignItems:"center",gap:2,mb:2,children:[s.jsx(O,{color:"info"}),s.jsxs(i,{flex:1,children:[s.jsx(a,{variant:"h6",children:"JSON 파일 가져오기"}),s.jsx(a,{variant:"body2",color:"text.secondary",children:"JSON 파일(.json)에서 데이터를 가져옵니다. 내보낸 형식과 호환됩니다."})]})]}),s.jsxs(d,{variant:"contained",color:"info",component:"label",startIcon:h?s.jsx(V,{}):s.jsx(O,{}),fullWidth:!0,children:[h?"JSON 데이터 추가하기":"JSON 파일 가져오기",s.jsx("input",{type:"file",accept:".json",onChange:ns,style:{display:"none"}})]})]})})]})]}),s.jsx(F,{severity:"info",sx:{mt:2},children:s.jsxs(a,{variant:"body2",children:["💡 ",s.jsx("strong",{children:"개발자 도구 사용법:"}),s.jsx("br",{}),"F12 → Console 탭에서 ",s.jsx("code",{children:"dataRecovery.current()"}),"로 현재 데이터 확인 가능"]})})]}),s.jsx(ms,{children:s.jsx(d,{onClick:E,children:"닫기"})})]})};export{As as default};
