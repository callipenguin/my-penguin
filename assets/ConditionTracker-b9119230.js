import{u as fe,a as g,j as t,B as c,T as m,f as k,aN as V,G as H,a6 as _,a7 as F,C as je,aO as be,Y as ye,J as Ce,D as ke,b as we,c as Se,aP as ve,d as De,e as $e}from"./mui-754dcb1a.js";import{d as x}from"./dayjs-9d6a636c.js";import{g as Z,l as ee,s as te}from"./index-23e7b333.js";const Oe=({themeConfig:S})=>{var N,X,q;const n=fe(),[f,R]=g.useState(x().startOf("week")),[v,w]=g.useState([]),[p,A]=g.useState(null),[E,D]=g.useState(!1),[O,T]=g.useState(""),U=g.useRef(null),[L,oe]=g.useState(!1),[B,re]=g.useState(null),M=(()=>{switch(S==null?void 0:S.id){case"desert-fox":return{excellent:"🦊",good:"🌵",normal:"☀️",tired:"🏜️",exhausted:"🔥"};case"sheep":return{excellent:"🐑",good:"🌿",normal:"🌱",tired:"🍃",exhausted:"🌾"};case"cat":return{excellent:"🐱",good:"🐟",normal:"🧶",tired:"🐾",exhausted:"😿"};default:return{excellent:"🐧",good:"🐟",normal:"❄️",tired:"🧊",exhausted:"🐻‍❄️"}}})(),Y=[{level:"excellent",emoji:M.excellent,color:"#4caf50",label:"최고"},{level:"good",emoji:M.good,color:"#8bc34a",label:"좋음"},{level:"normal",emoji:M.normal,color:"#ffc107",label:"보통"},{level:"tired",emoji:M.tired,color:"#ff9800",label:"피곤"},{level:"exhausted",emoji:M.exhausted,color:"#f44336",label:"매우 피곤"}],ne=Array.from({length:24},(e,o)=>o),G=Array.from({length:7},(e,o)=>f.add(o,"day"));g.useEffect(()=>{se()},[f]);const I=e=>x(e).format("YYYYMM"),ae=(e,o)=>{const r=x(e).startOf("month"),s=x(o).endOf("month"),a=[];let l=r.clone();for(;l.isBefore(s)||l.isSame(s,"month");)a.push(l.format("YYYYMM")),l=l.add(1,"month");return Array.from(new Set(a))},se=async()=>{try{const e=Z();if(!e){console.info("조건 데이터는 로그인 시 Firebase로 동기화됩니다."),w([]);return}const o=f.startOf("week"),r=f.add(6,"day"),s=r.subtract(3,"week"),a=ae(s.toISOString(),r.toISOString()),j=(await Promise.all(a.map(d=>ee(e.uid,`conditions_${d}`)))).filter(d=>d.success&&Array.isArray(d.data)).flatMap(d=>d.data);if(j.length>0){w(j);return}const y=await ee(e.uid,"conditions");if(y.success&&Array.isArray(y.data)&&y.data.length>0){const d=y.data;w(d);try{const b=d.reduce((h,i)=>{const u=I(i.date);return h[u]||(h[u]=[]),h[u].push(i),h},{});await Promise.all(Object.entries(b).map(([h,i])=>te(e.uid,`conditions_${h}`,i))),console.log("레거시 컨디션을 월별로 마이그레이션 완료")}catch(b){console.warn("레거시 컨디션 마이그레이션 중 경고:",b)}return}w([])}catch(e){console.error("컨디션 데이터 로드 실패:",e),w([])}},P=async(e,o)=>{try{const r=Z();if(!r){console.info("로그인 상태에서만 컨디션 데이터가 저장됩니다.");return}const s=e.filter(a=>I(a.date)===o);await te(r.uid,`conditions_${o}`,s)}catch(r){console.error("월별 컨디션 저장 실패:",r)}},z=(e,o)=>v.find(r=>r.date===e&&r.hour===o),ie=async e=>{if(!p)return;const o=z(p.date,p.hour);let r;if(o)r=v.map(s=>s.id===o.id?{...s,condition:e,memo:O,updatedAt:new Date().toISOString()}:s);else{const s={id:Date.now().toString(),date:p.date,hour:p.hour,condition:e,memo:O,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};r=[...v,s]}w(r),await P(r,I(p.date)),D(!1),A(null),T("")},le=async()=>{if(!p)return;const e=z(p.date,p.hour);if(e){const o=v.map(r=>r.id===e.id?{...r,memo:O,updatedAt:new Date().toISOString()}:r);w(o),await P(o,I(p.date))}D(!1),A(null),T("")};g.useEffect(()=>{const e=x(),o=e.format("YYYY-MM-DD"),r=e.hour();A({date:o,hour:r}),D(!0)},[]),g.useEffect(()=>{if(E){const e=setTimeout(()=>{var o;return(o=U.current)==null?void 0:o.focus()},100);return()=>clearTimeout(e)}},[E]);const C=e=>Y.find(o=>o.level===e),de={excellent:5,good:4,normal:3,tired:2,exhausted:1},ce=e=>e>=4.5?"excellent":e>=3.5?"good":e>=2.5?"normal":e>=1.5?"tired":"exhausted",K=e=>{const o=x().subtract(3,"week"),r=v.filter(i=>i.hour===e);if(r.length===0)return{counts:{excellent:0,good:0,normal:0,tired:0,exhausted:0},averageLevel:null,hasThreeWeeksData:!1};const s=r.reduce((i,u)=>x(u.date).isBefore(i)?x(u.date):i,x(r[0].date)),a=s.isBefore(o)||s.isSame(o,"day"),l=r.filter(i=>x(i.date).isAfter(o)||x(i.date).isSame(o,"day")),j=l.reduce((i,u)=>(i[u.condition]=(i[u.condition]??0)+1,i),{excellent:0,good:0,normal:0,tired:0,exhausted:0});if(!a||l.length===0)return{counts:j,averageLevel:null,hasThreeWeeksData:a};const y=Object.entries(j).reduce((i,[u,W])=>i+de[u]*W,0),d=Object.values(j).reduce((i,u)=>i+u,0),b=d>0?y/d:0,h=d>0?ce(b):null;return{counts:j,averageLevel:h,hasThreeWeeksData:a}},ue=(e,o,r)=>{A({date:e,hour:o}),T((r==null?void 0:r.memo)??"");const s=K(o);re(s.hasThreeWeeksData?s.averageLevel:null),D(!0)},J=e=>[n.palette.error.main+"08",n.palette.info.main+"08",n.palette.success.main+"08",n.palette.warning.main+"08",n.palette.secondary.main+"08",n.palette.primary.main+"08",n.palette.grey[500]+"08"][e]||n.palette.grey[100],$=e=>[n.palette.error.main,n.palette.info.main,n.palette.success.main,n.palette.warning.main,n.palette.secondary.main,n.palette.primary.main,n.palette.grey[600]][e]||n.palette.text.primary,me=(e,o)=>{const r=o!==void 0?J(o):"transparent";if(!e)return r;const s=C(e.condition);return s?`linear-gradient(135deg, ${s.color}30, ${r})`:r},xe=()=>{const e=f.format("YYYY-MM-DD"),o=f.add(6,"day").format("YYYY-MM-DD"),r=v.filter(a=>a.date>=e&&a.date<=o),s=Y.reduce((a,l)=>(a[l.level]=r.filter(j=>j.condition===l.level).length,a),{});return{weekConditions:r,conditionCounts:s}},{weekConditions:pe,conditionCounts:he}=xe();return t.jsxs(c,{sx:{p:3},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[t.jsxs(c,{children:[t.jsx(m,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"💚 컨디션 체크"}),t.jsxs(m,{variant:"body1",color:"textSecondary",children:[((N=S==null?void 0:S.concepts)==null?void 0:N.animal)||"동물","처럼 시간별 컨디션을 기록하고 패턴을 분석해보세요"]})]}),t.jsxs(c,{sx:{display:"flex",gap:2,alignItems:"center"},children:[t.jsx(k,{startIcon:t.jsx(V,{}),onClick:()=>R(f.subtract(1,"week")),children:"이전 주"}),t.jsx(k,{variant:"contained",onClick:()=>R(x().startOf("week")),children:"이번 주"}),t.jsx(k,{startIcon:t.jsx(V,{}),onClick:()=>R(f.add(1,"week")),children:"다음 주"}),t.jsx(k,{variant:L?"contained":"outlined",onClick:()=>oe(e=>!e),children:"누적 보기"})]})]}),t.jsxs(H,{container:!0,spacing:3,sx:{mb:4},children:[t.jsx(H,{item:!0,xs:12,md:8,children:t.jsx(_,{children:t.jsxs(F,{children:[t.jsxs(m,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:["📊 이번 주 통계 (",f.format("MM/DD")," - ",f.add(6,"day").format("MM/DD"),")"]}),t.jsx(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:Y.map(e=>t.jsx(je,{label:`${e.emoji} ${e.label}: ${he[e.level]}회`,sx:{bgcolor:e.color+"20",color:e.color,fontWeight:500}},e.level))}),t.jsxs(m,{variant:"body2",color:"textSecondary",sx:{mt:2},children:["총 ",pe.length,"개의 컨디션이 기록되었습니다"]})]})})}),t.jsx(H,{item:!0,xs:12,md:4,children:t.jsx(_,{children:t.jsxs(F,{sx:{textAlign:"center"},children:[t.jsx(be,{sx:{fontSize:40,color:n.palette.primary.main,mb:1}}),t.jsx(m,{variant:"h6",gutterBottom:!0,children:"주간 평균"}),t.jsx(m,{variant:"h4",color:"primary",children:"3.2/5"}),t.jsx(k,{size:"small",startIcon:t.jsx(ye,{}),sx:{mt:1},children:"분석 보기"})]})})})]}),t.jsx(_,{children:t.jsxs(F,{children:[t.jsx(m,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"🗓️ 시간별 컨디션 그리드"}),t.jsx(c,{sx:{display:"flex",gap:1,mb:3,flexWrap:"wrap"},children:Y.map(e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.5},children:[t.jsx(c,{sx:{width:16,height:16,backgroundColor:e.color+"30",border:`2px solid ${e.color}`,borderRadius:1}}),t.jsxs(m,{variant:"caption",children:[e.emoji," ",e.label]})]},e.level))}),t.jsx(c,{sx:{overflowX:"auto",position:"relative",maxHeight:"70vh",overflowY:"auto"},children:t.jsxs(c,{sx:{minWidth:800},children:[t.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"80px repeat(7, 1fr)",gap:1,mb:1,position:"sticky",top:0,backgroundColor:n.palette.background.paper,zIndex:10,borderBottom:`2px solid ${n.palette.divider}`,pb:1},children:[t.jsx(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",backgroundColor:n.palette.mode==="dark"?n.palette.background.paper:n.palette.grey[100],borderRadius:1,border:`1px solid ${n.palette.divider}`},children:t.jsx(m,{variant:"caption",fontWeight:"bold",children:"시간"})}),G.map((e,o)=>t.jsxs(c,{sx:{textAlign:"center",p:1.5,backgroundColor:J(o),borderRadius:2,border:`2px solid ${$(o)}30`,boxShadow:1},children:[t.jsx(m,{variant:"body2",fontWeight:"bold",sx:{color:$(o)},children:e.format("ddd")}),t.jsx(m,{variant:"caption",sx:{color:$(o),opacity:.8,display:"block",mt:.5},children:e.format("MM/DD")}),e.isSame(x(),"day")&&t.jsx(c,{sx:{width:6,height:6,backgroundColor:$(o),borderRadius:"50%",mx:"auto",mt:.5}})]},e.format("YYYY-MM-DD")))]}),ne.map(e=>t.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"80px repeat(7, 1fr)",gap:1,mb:1,"&:hover":{"& > div":{transform:"scale(1.01)",transition:"transform 0.1s ease"}}},children:[t.jsx(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",p:1,backgroundColor:n.palette.mode==="dark"?n.palette.background.paper:n.palette.grey[50],borderRadius:1,border:`1px solid ${n.palette.divider}`,position:"sticky",left:0,zIndex:5,minHeight:50},children:t.jsxs(m,{variant:"body2",fontWeight:"bold",sx:{color:n.palette.text.primary},children:[e.toString().padStart(2,"0"),":00"]})}),G.map((o,r)=>{var i,u;const s=o.format("YYYY-MM-DD"),a=z(s,e),l=a?C(a.condition):null,y=o.isSame(x(),"day")&&e===x().hour(),d=L?K(e):null,b=d!=null&&d.averageLevel?C(d.averageLevel):null,h=d?Object.entries(d.counts).filter(([,W])=>W>0).map(([W,ge])=>{var Q;return`${(Q=C(W))==null?void 0:Q.emoji}x${ge}`}).join(" · "):null;return t.jsx(Ce,{title:a?`${o.format("ddd")} ${e}시 - ${l==null?void 0:l.emoji} ${l==null?void 0:l.label}${a.memo?` - ${a.memo}`:""}${b?`
과거 ${e}시 요약: ${h}`:""}`:`${o.format("ddd")} ${e}시 - 컨디션 기록하기${b?`
과거 ${e}시 요약: ${h}`:""}`,arrow:!0,children:t.jsxs(c,{onClick:()=>ue(s,e,a),sx:{minHeight:50,backgroundColor:me(a,r),border:a?`3px solid ${((i=C(a.condition))==null?void 0:i.color)||n.palette.divider}`:`2px solid ${$(r)}20`,borderRadius:2,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",transition:"all 0.2s ease","&:hover":{transform:"scale(1.05)",boxShadow:2,borderColor:a?(u=C(a.condition))==null?void 0:u.color:$(r)},...y&&{boxShadow:`0 0 0 3px ${n.palette.primary.main}40`,borderColor:n.palette.primary.main}},children:[a&&l&&t.jsx(m,{sx:{fontSize:"1.5rem"},children:l.emoji}),!a&&b&&L&&t.jsx(m,{sx:{fontSize:"1.2rem",opacity:.6},children:b.emoji}),y&&t.jsx(c,{sx:{position:"absolute",top:2,right:2,width:8,height:8,backgroundColor:n.palette.primary.main,borderRadius:"50%",animation:"pulse 2s infinite"}}),(a==null?void 0:a.memo)&&t.jsx(c,{sx:{position:"absolute",bottom:2,left:2,width:6,height:6,backgroundColor:n.palette.info.main,borderRadius:"50%"}})]})},`${s}-${e}`)})]},e))]})})]})}),t.jsxs(ke,{open:E,onClose:()=>D(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(we,{children:p&&`컨디션 기록 - ${x(p.date).format("MM/DD")} ${p.hour.toString().padStart(2,"0")}:00`}),t.jsxs(Se,{children:[B&&t.jsxs(m,{variant:"body2",sx:{mb:1},children:["추천 기본값: ",(X=C(B))==null?void 0:X.emoji," ",(q=C(B))==null?void 0:q.label]}),t.jsx(m,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"컨디션을 선택하세요:"}),t.jsx(ve,{variant:"outlined",sx:{mb:3,flexWrap:"wrap"},children:Y.map(e=>t.jsxs(k,{onClick:()=>ie(e.level),sx:{bgcolor:e.color+"20",borderColor:e.color,color:e.color,"&:hover":{bgcolor:e.color+"30",borderColor:e.color},...B===e.level&&{boxShadow:`0 0 0 2px ${e.color}80 inset`}},children:[e.emoji," ",e.label]},e.level))}),t.jsx(De,{inputRef:U,autoFocus:!0,fullWidth:!0,multiline:!0,rows:3,label:"메모 (선택사항)",placeholder:"컨디션에 대한 상세한 기록을 남겨보세요...",value:O,onChange:e=>T(e.target.value)})]}),t.jsxs($e,{children:[t.jsx(k,{onClick:()=>D(!1),children:"취소"}),t.jsx(k,{onClick:le,variant:"contained",children:"저장"})]})]})]})};export{Oe as default};
