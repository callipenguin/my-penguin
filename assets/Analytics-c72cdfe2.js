import{u as Be,a as m,j as e,B as c,T as r,C as M,f as _,aj as We,aF as Ye,g as q,G as b,a6 as v,a7 as T,_ as Ee,W as $e,aO as ze,bk as Pe,bl as Ae,ag as Fe,A as R,aN as ne,L as ie,q as oe,v as ce,bb as Le,be as Oe,bf as _e,b7 as Re,bg as Ne,U as Ue,bm as He,ap as Ve,bn as qe,bo as Ge,bp as de,bq as j,br as Je,d as k,J as N,o as U,a_ as Ze,aZ as Ke,aL as Qe,aM as Xe,bs as et,D as tt,b as at,c as rt,F as st,I as lt,S as nt,M as ue,e as it}from"./mui-754dcb1a.js";import{g as E,l as ot,d as ct,e as dt,f as ut,h as xt,i as jt}from"./index-23e7b333.js";import{d as p}from"./dayjs-9d6a636c.js";const vt=({themeConfig:u})=>{var te;const g=Be(),[G,xe]=m.useState([]),[je,J]=m.useState(!0),[ht,he]=m.useState(null),[me,Z]=m.useState(!0),[C,mt]=m.useState(p().startOf("week").format("YYYY-MM-DD")),[S,pe]=m.useState([]),[B,ge]=m.useState([]),[pt,ye]=m.useState([]),[$,H]=m.useState(null),[z,D]=m.useState({}),[be,L]=m.useState(!1),[d,W]=m.useState({sessionType:"work",duration:25,actualDuration:25}),K=(()=>{const a={excellent:{label:"최고",score:5,color:g.palette.success.dark},good:{label:"좋음",score:4,color:g.palette.success.main},normal:{label:"보통",score:3,color:g.palette.warning.main},tired:{label:"피곤",score:2,color:g.palette.warning.dark},exhausted:{label:"매우 피곤",score:1,color:g.palette.error.main}},t={penguin:{excellent:"🐧",good:"🐟",normal:"❄️",tired:"🧊",exhausted:"🐻‍❄️"},"desert-fox":{excellent:"🦊",good:"🌵",normal:"☀️",tired:"🏜️",exhausted:"🔥"},sheep:{excellent:"🐑",good:"🌿",normal:"🌱",tired:"🍃",exhausted:"🌾"},cat:{excellent:"🐱",good:"🐟",normal:"🧶",tired:"🐾",exhausted:"😿"}},s=(u==null?void 0:u.id)||"penguin",i=t[s]||t.penguin;return Object.keys(a).reduce((y,h)=>(y[h]={...a[h],emoji:i[h]},y),{})})();m.useEffect(()=>{fe(),Q(),P()},[C]);const fe=async()=>{try{J(!0);const a=E();if(a){const t=await ot(a.uid,"conditions");t.success&&t.data&&xe(t.data)}}catch(a){console.error("컨디션 데이터 로드 실패:",a)}finally{J(!1)}},Q=async()=>{try{Z(!0);const a=E();if(a){const t=await ct(a.uid,C);t.success&&t.data&&he(t.data)}}catch(a){console.error("뽀모도로 통계 로드 실패:",a)}finally{Z(!1)}},P=async()=>{try{const a=E();if(a){const t=p(C),s=t.add(6,"day"),i=await dt(a.uid,t.format("YYYY-MM-DD"),s.format("YYYY-MM-DD"));if(i.success&&i.data){const y=i.data;ye(y);const h=t,Y=s,o=y.filter(l=>{const x=p(l.startTime);return x.isAfter(h.subtract(1,"day"))&&x.isBefore(Y.add(1,"day"))&&l.completed&&l.sessionType==="work"}),n=[];for(let l=0;l<7;l++){const re=h.add(l,"day").format("YYYY-MM-DD"),se=o.filter(f=>p(f.startTime).format("YYYY-MM-DD")===re),F={};let le=0;se.forEach(f=>{le+=f.duration,F[f.projectId]||(F[f.projectId]={title:f.projectTitle,minutes:0,sessions:0}),F[f.projectId].minutes+=f.duration,F[f.projectId].sessions+=1}),n.push({date:re,sessions:se,totalMinutes:le,projectBreakdown:F})}pe(n);const I={},ae=o.reduce((l,x)=>l+x.duration,0);o.forEach(l=>{I[l.projectId]||(I[l.projectId]={projectId:l.projectId,projectTitle:l.projectTitle,totalMinutes:0,totalSessions:0,percentage:0,tasks:{}});const x=I[l.projectId];x.totalMinutes+=l.duration,x.totalSessions+=1,x.tasks[l.taskId]||(x.tasks[l.taskId]={title:l.taskTitle,minutes:0,sessions:0}),x.tasks[l.taskId].minutes+=l.duration,x.tasks[l.taskId].sessions+=1});const Ce=Object.values(I).map(l=>({...l,percentage:ae>0?l.totalMinutes/ae*100:0})).sort((l,x)=>x.totalMinutes-l.totalMinutes);ge(Ce)}}}catch(a){console.error("상세 뽀모도로 데이터 로드 실패:",a)}},ve=()=>{if(!G.length)return{weeklyStats:{},totalEntries:0,averageScore:0};const a=p(C),t=a.add(6,"day"),s=G.filter(o=>{const n=p(o.date);return n.isAfter(a.subtract(1,"day"))&&n.isBefore(t.add(1,"day"))}),i={};let y=0,h=s.length;for(let o=0;o<7;o++)i[o]={count:0,total:0,average:0};s.forEach(o=>{const n=p(o.date).day(),I=K[o.condition].score;i[n].count++,i[n].total+=I,y+=I}),Object.keys(i).forEach(o=>{const n=parseInt(o);i[n].count>0&&(i[n].average=i[n].total/i[n].count)});const Y=h>0?y/h:0;return{weeklyStats:i,totalEntries:h,averageScore:Y}},{weeklyStats:X,totalEntries:ee,averageScore:O}=ve(),A=["일","월","화","수","목","금","토"],w=a=>{const t=Math.floor(a/60),s=a%60;return t>0?`${t}시간 ${s}분`:`${s}분`},Te=()=>"📊 활동 분석",ke=()=>{var t;return`${((t=u==null?void 0:u.concepts)==null?void 0:t.animal)||"펭귄"}의 생활 패턴과 뽀모도로 집중 세션을 분석해서 최적의 시간을 찾아드려요`},Se=a=>{H(a.id),D({[a.id]:{duration:a.duration,actualDuration:a.actualDuration||a.duration,projectTitle:a.projectTitle,taskTitle:a.taskTitle}})},De=async a=>{const t=z[a];if(t)try{const s=E();if(!s)return;const i=await ut(s.uid,a,{duration:t.duration,actualDuration:t.actualDuration||t.duration,projectTitle:t.projectTitle,taskTitle:t.taskTitle});i.success?(H(null),D({}),console.log(`✅ 세션 수정 완료: ${a}`),P()):(console.error("세션 수정 실패:",i.error),alert("세션 수정에 실패했습니다: "+i.error))}catch(s){console.error("세션 수정 실패:",s),alert("세션 수정 중 오류가 발생했습니다.")}},we=()=>{H(null),D({})},Ie=async a=>{if(confirm("이 세션을 삭제하시겠습니까?"))try{const t=E();if(!t)return;const s=await xt(t.uid,a);s.success?(console.log(`🗑️ 세션 삭제 완료: ${a}`),P()):(console.error("세션 삭제 실패:",s.error),alert("세션 삭제에 실패했습니다: "+s.error))}catch(t){console.error("세션 삭제 실패:",t),alert("세션 삭제 중 오류가 발생했습니다.")}},Me=async()=>{if(!d.projectTitle||!d.taskTitle||!d.duration){alert("모든 필드를 입력해주세요.");return}try{const a=E();if(!a)return;const t=new Date,s={projectId:`proj_${Date.now()}`,projectTitle:d.projectTitle,taskId:`task_${Date.now()}`,taskTitle:d.taskTitle,sessionType:d.sessionType,duration:d.duration,actualDuration:d.actualDuration||d.duration,startTime:d.startTime||t.toISOString(),endTime:d.endTime||new Date(t.getTime()+d.duration*6e4).toISOString(),completed:!0};(await jt(a.uid,s)).success&&(L(!1),W({sessionType:"work",duration:25,actualDuration:25}),console.log("✅ 새 세션 추가 완료"),P())}catch(a){console.error("세션 추가 실패:",a)}},V=Object.entries(X).filter(([a,t])=>t.count>0).sort((a,t)=>t[1].average-a[1].average)[0];return e.jsxs(c,{sx:{p:3},children:[e.jsxs(c,{sx:{mb:4},children:[e.jsx(r,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:Te()}),e.jsx(r,{variant:"body1",color:"textSecondary",children:ke()})]}),e.jsxs(c,{sx:{mb:6},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{background:"linear-gradient(45deg, #ff6b6b 30%, #feca57 90%)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"🍅 뽀모도로 분석"}),e.jsx(M,{label:`${C.split("-")[1]}월 ${C.split("-")[2]}일 주차`,variant:"outlined",size:"small"}),e.jsx(_,{size:"small",startIcon:e.jsx(We,{}),onClick:()=>{Q(),P()},children:"새로고침"}),e.jsx(_,{size:"small",variant:"contained",startIcon:e.jsx(Ye,{}),onClick:()=>L(!0),children:"세션 추가"})]}),me?e.jsx(c,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(q,{})}):e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{item:!0,xs:12,md:6,lg:3,children:e.jsx(v,{children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ee,{color:"primary"})," 주간 총 집중시간"]}),e.jsx(r,{variant:"h4",color:"primary",fontWeight:"bold",children:w(B.reduce((a,t)=>a+t.totalMinutes,0))}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["총 ",B.reduce((a,t)=>a+t.totalSessions,0),"회 세션"]})]})})}),e.jsx(b,{item:!0,xs:12,md:6,lg:3,children:e.jsx(v,{children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{color:"primary"})," 활동한 프로젝트"]}),e.jsxs(r,{variant:"h4",color:"primary",fontWeight:"bold",children:[B.length,"개"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"이번 주 작업 프로젝트"})]})})}),e.jsx(b,{item:!0,xs:12,md:6,lg:3,children:e.jsx(v,{children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ze,{color:"primary"})," 일평균 집중시간"]}),e.jsx(r,{variant:"h4",color:"primary",fontWeight:"bold",children:w(Math.round(B.reduce((a,t)=>a+t.totalMinutes,0)/7))}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"하루 평균 집중시간"})]})})}),e.jsx(b,{item:!0,xs:12,md:6,lg:3,children:e.jsx(v,{children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pe,{color:"primary"})," 가장 활발한 날"]}),e.jsx(r,{variant:"h4",color:"primary",fontWeight:"bold",children:S.length>0?A[p((te=S.sort((a,t)=>t.totalMinutes-a.totalMinutes)[0])==null?void 0:te.date).day()]+"요일":"-"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:S.length>0?w(Math.max(...S.map(a=>a.totalMinutes))):"데이터 없음"})]})})}),e.jsx(b,{item:!0,xs:12,lg:8,children:e.jsx(v,{children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{color:"primary"})," 프로젝트별 시간 투자 비율"]}),B.length>0?e.jsx(c,{children:B.map((a,t)=>e.jsxs(c,{sx:{mb:2},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",fontWeight:"medium",children:a.projectTitle}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{label:`${a.percentage.toFixed(1)}%`,size:"small",variant:"outlined"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:w(a.totalMinutes)})]})]}),e.jsx(Fe,{variant:"determinate",value:a.percentage,sx:{height:8,borderRadius:4,backgroundColor:g.palette.grey[200],"& .MuiLinearProgress-bar":{borderRadius:4,backgroundColor:g.palette.primary.main}}})]},a.projectId))}):e.jsxs(R,{severity:"info",children:["이번 주에는 뽀모도로 세션이 없어요. 집중 시간을 기록해보세요! ",u==null?void 0:u.emoji]})]})})}),e.jsx(b,{item:!0,xs:12,lg:4,children:e.jsx(v,{sx:{height:"100%"},children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{color:"primary"})," 일별 활동 요약"]}),e.jsx(ie,{dense:!0,children:S.map((a,t)=>e.jsx(oe,{sx:{px:0},children:e.jsx(ce,{primary:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body2",children:[A[p(a.date).day()],"요일 (",p(a.date).format("M/D"),")"]}),e.jsx(M,{label:a.totalMinutes>0?w(a.totalMinutes):"휴식",size:"small",color:a.totalMinutes>0?"primary":"default",variant:a.totalMinutes>0?"filled":"outlined"})]}),secondary:a.sessions.length>0?`${a.sessions.length}회 세션 • ${Object.keys(a.projectBreakdown).length}개 프로젝트`:"활동 없음"})},a.date))})]})})}),e.jsx(b,{item:!0,xs:12,children:e.jsx(v,{children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Le,{color:"primary"})," 📅 상세 일별 활동 분석"]}),S.some(a=>a.sessions.length>0)?S.filter(a=>a.sessions.length>0).map(a=>e.jsxs(Oe,{sx:{mt:1},children:[e.jsx(_e,{expandIcon:e.jsx(Re,{}),children:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",pr:2},children:[e.jsxs(r,{variant:"body1",fontWeight:"medium",children:[A[p(a.date).day()],"요일 (",p(a.date).format("YYYY년 M월 D일"),")"]}),e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(M,{label:`${w(a.totalMinutes)}`,size:"small",color:"primary"}),e.jsx(M,{label:`${a.sessions.length}회 세션`,size:"small",variant:"outlined"})]})]})}),e.jsx(Ne,{children:e.jsxs(c,{children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,sx:{mt:1},children:"프로젝트별 활동:"}),Object.entries(a.projectBreakdown).map(([t,s])=>e.jsxs(c,{sx:{mb:2,pl:2,borderLeft:`3px solid ${g.palette.primary.main}`},children:[e.jsxs(r,{variant:"body2",fontWeight:"medium",children:["📁 ",s.title]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[w(s.minutes)," • ",s.sessions,"회 세션"]})]},t)),e.jsx(Ue,{sx:{my:2}}),e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"세션 상세 내역:"}),e.jsx(He,{component:Ve,variant:"outlined",children:e.jsxs(qe,{size:"small",children:[e.jsx(Ge,{children:e.jsxs(de,{children:[e.jsx(j,{children:"시간"}),e.jsx(j,{children:"프로젝트"}),e.jsx(j,{children:"작업"}),e.jsx(j,{align:"right",children:"집중시간"}),e.jsx(j,{align:"right",children:"실제시간"}),e.jsx(j,{align:"center",children:"상태"}),e.jsx(j,{align:"center",children:"편집"})]})}),e.jsx(Je,{children:a.sessions.sort((t,s)=>new Date(t.startTime).getTime()-new Date(s.startTime).getTime()).map((t,s)=>{var i,y,h,Y;return e.jsxs(de,{children:[e.jsx(j,{children:p(t.startTime).format("HH:mm")}),e.jsx(j,{children:$===t.id?e.jsx(k,{size:"small",value:((i=z[t.id])==null?void 0:i.projectTitle)||t.projectTitle,onChange:o=>D(n=>({...n,[t.id]:{...n[t.id],projectTitle:o.target.value}}))}):t.projectTitle}),e.jsx(j,{children:$===t.id?e.jsx(k,{size:"small",value:((y=z[t.id])==null?void 0:y.taskTitle)||t.taskTitle,onChange:o=>D(n=>({...n,[t.id]:{...n[t.id],taskTitle:o.target.value}}))}):t.taskTitle}),e.jsx(j,{align:"right",children:$===t.id?e.jsx(k,{size:"small",type:"number",value:((h=z[t.id])==null?void 0:h.duration)||t.duration,onChange:o=>D(n=>({...n,[t.id]:{...n[t.id],duration:parseFloat(o.target.value)||0}})),sx:{width:"70px"}}):`${t.duration}분`}),e.jsx(j,{align:"right",children:$===t.id?e.jsx(k,{size:"small",type:"number",value:((Y=z[t.id])==null?void 0:Y.actualDuration)||t.actualDuration||t.duration,onChange:o=>D(n=>({...n,[t.id]:{...n[t.id],actualDuration:parseFloat(o.target.value)||0}})),sx:{width:"70px"}}):e.jsxs(c,{children:[e.jsx(r,{variant:"body2",children:t.actualDuration?`${t.actualDuration}분`:`${t.duration}분`}),t.actualDuration&&t.actualDuration!==t.duration&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["(설정: ",t.duration,"분)"]})]})}),e.jsx(j,{align:"center",children:e.jsx(M,{label:t.completed?"완료":"중단",size:"small",color:t.completed?"success":"warning",variant:t.actualDuration&&t.actualDuration!==t.duration?"outlined":"filled"})}),e.jsx(j,{align:"center",children:$===t.id?e.jsxs(c,{sx:{display:"flex",gap:.5},children:[e.jsx(N,{title:"저장",children:e.jsx(U,{size:"small",color:"primary",onClick:()=>De(t.id),children:e.jsx(Ze,{})})}),e.jsx(N,{title:"취소",children:e.jsx(U,{size:"small",onClick:we,children:e.jsx(Ke,{})})})]}):e.jsxs(c,{sx:{display:"flex",gap:.5},children:[e.jsx(N,{title:"편집",children:e.jsx(U,{size:"small",onClick:()=>Se(t),children:e.jsx(Qe,{})})}),e.jsx(N,{title:"삭제",children:e.jsx(U,{size:"small",color:"error",onClick:()=>Ie(t.id),children:e.jsx(Xe,{})})})]})})]},t.id)})})]})})]})})]},a.date)):e.jsxs(R,{severity:"info",sx:{mt:2},children:["이번 주에는 뽀모도로 활동이 없어요. ",u==null?void 0:u.emoji," 타이머에서 집중 세션을 시작해보세요!"]})]})})})]})]}),e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{item:!0,xs:12,md:6,children:e.jsx(v,{children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(et,{})," 주간 컨디션 평균"]}),je?e.jsx(q,{size:24}):ee>0?e.jsxs(c,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(q,{variant:"determinate",value:O/5*100,size:60,sx:{color:O>=4?g.palette.success.main:O>=3?g.palette.warning.main:g.palette.error.main}}),e.jsxs(c,{children:[e.jsxs(r,{variant:"h4",fontWeight:"bold",children:[O.toFixed(1),"점"]}),e.jsxs(r,{variant:"body2",color:"textSecondary",children:[ee,"회 기록"]})]})]}),V&&e.jsx(R,{severity:"success",icon:K.excellent.emoji,children:e.jsxs(r,{variant:"body2",children:[e.jsxs("strong",{children:[A[parseInt(V[0])],"요일"]}),"이 가장 좋았어요! (",V[1].average.toFixed(1),"점)"]})})]}):e.jsxs(R,{severity:"info",children:["이번 주 컨디션 기록이 없어요. ",u==null?void 0:u.emoji," 건강 탭에서 컨디션을 기록해보세요!"]})]})})}),e.jsx(b,{item:!0,xs:12,md:6,children:e.jsx(v,{sx:{height:"100%"},children:e.jsxs(T,{children:[e.jsxs(r,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{})," 요일별 컨디션 순위"]}),e.jsx(ie,{dense:!0,children:Object.entries(X).filter(([a,t])=>t.count>0).sort((a,t)=>t[1].average-a[1].average).map(([a,t],s)=>e.jsx(oe,{sx:{px:0},children:e.jsx(ce,{primary:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{variant:"body2",children:["#",s+1," ",A[parseInt(a)],"요일"]}),e.jsx(M,{label:`${t.average.toFixed(1)}점`,size:"small",color:t.average>=4?"success":t.average>=3?"warning":"error"})]}),secondary:`${t.count}회 기록`})},a))})]})})})]}),e.jsxs(tt,{open:be,onClose:()=>L(!1),children:[e.jsx(at,{children:"새 뽀모도로 세션 추가"}),e.jsx(rt,{children:e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(k,{label:"프로젝트 제목",value:d.projectTitle,onChange:a=>W(t=>({...t,projectTitle:a.target.value})),fullWidth:!0}),e.jsx(k,{label:"작업 제목",value:d.taskTitle,onChange:a=>W(t=>({...t,taskTitle:a.target.value})),fullWidth:!0}),e.jsx(k,{label:"집중 시간 (분)",type:"number",value:d.duration,onChange:a=>W(t=>({...t,duration:parseFloat(a.target.value)||0})),fullWidth:!0}),e.jsx(k,{label:"실제 집중 시간 (분)",type:"number",value:d.actualDuration,onChange:a=>W(t=>({...t,actualDuration:parseFloat(a.target.value)||0})),fullWidth:!0}),e.jsxs(st,{fullWidth:!0,children:[e.jsx(lt,{children:"세션 타입"}),e.jsxs(nt,{value:d.sessionType,label:"세션 타입",onChange:a=>W(t=>({...t,sessionType:a.target.value})),children:[e.jsx(ue,{value:"work",children:"작업"}),e.jsx(ue,{value:"break",children:"휴식"})]})]})]})}),e.jsxs(it,{children:[e.jsx(_,{onClick:()=>L(!1),children:"취소"}),e.jsx(_,{onClick:Me,variant:"contained",children:"추가"})]})]})]})};export{vt as default};
