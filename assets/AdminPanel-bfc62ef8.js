import{u as Ie,n as Re,a as r,j as e,ab as ze,B as a,T as t,ap as m,a$ as Be,b0 as L,a6 as h,a7 as g,m as J,G as l,a1 as Fe,ag as Le,aa as Pe,w as K,C as f,bB as Oe,am as Q,aZ as Z,f as u,aI as Ee,aJ as Ne,aq as $e,D as V,b as X,c as _,d as q,e as ee,A as se,bk as He,bC as te,K as ae,Y as Ue,o as P,aj as Ye,L as Ge,q as Je,bD as Ke,b1 as Qe,v as Ze,bE as Ve,bn as Xe,bo as _e,bp as qe,bq as re,br as o,bs as es,J as ss,bF as ts,aM as as}from"./mui-2bb62da7.js";import{q as rs,r as ns,t as ne,v as is,w as os,x as ls,y as cs,z as ds,A as xs,B as hs,C as js,D as ps}from"./index-9345ab22.js";import{d as C,r as ms}from"./dayjs-9d6a636c.js";import{a as gs,s as us,d as bs}from"./presence-5edbe608.js";C.extend(ms);C.locale("ko");const Ss=({themeConfig:T})=>{const ie=Ie();Re(ie.breakpoints.down("md"));const[S,D]=r.useState([]),[oe,O]=r.useState(!0),[j,M]=r.useState(null),[le,v]=r.useState(!1),[x,I]=r.useState(null),[R,E]=r.useState(""),[w,c]=r.useState({open:!1,message:"",severity:"success"}),[A,ce]=r.useState(0),[z,de]=r.useState([]),[N,xe]=r.useState(0),[he,je]=r.useState([]),[b,pe]=r.useState({total:0,pending:0,inProgress:0,completed:0,rejected:0,byType:{},byPriority:{}}),[me,ge]=r.useState([]),[i,$]=r.useState(null),[ue,W]=r.useState(!1),[k,H]=r.useState(""),[U,Y]=r.useState(!1),[be,ye]=r.useState(""),ve=async()=>{try{const s=await is();Y(s.isMaintenanceMode),ye(s.message||"")}catch(s){console.error("점검 모드 상태 로드 실패:",s)}},fe=async s=>{try{if((await os(s,be)).success)Y(s),c({open:!0,message:`점검 모드가 ${s?"활성화":"비활성화"}되었습니다.`,severity:"success"});else throw new Error("점검 모드 설정 실패")}catch(n){c({open:!0,message:`점검 모드 설정 실패: ${n.message}`,severity:"error"})}};r.useEffect(()=>{B(),ve();const s=gs((d,Me)=>{de(d),xe(Me)}),n=rs(d=>{je(d),pe(js(d))}),p=us(d=>{ge(d)});return()=>{s(),n(),p()}},[]),r.useEffect(()=>{B()},[]);const B=async()=>{try{O(!0);const s=await ns();s.success&&s.data?D(s.data):D([])}catch(s){console.error("접근 요청 로드 실패:",s),c({open:!0,message:"데이터를 불러오는데 실패했습니다.",severity:"error"}),D([])}finally{O(!1)}},F=async(s,n,p)=>{try{const d=await ls(s,n,p);d.success?(c({open:!0,message:d.message,severity:"success"}),p&&i&&await cs(i,p),W(!1),$(null),H("")):c({open:!0,message:d.message,severity:"error"})}catch(d){console.error("피드백 상태 업데이트 실패:",d),c({open:!0,message:"상태 업데이트 중 오류가 발생했습니다.",severity:"error"})}},Ce=async s=>{if(window.confirm("정말로 이 피드백을 삭제하시겠습니까?"))try{const n=await ps(s);c({open:!0,message:n.message,severity:n.success?"success":"error"})}catch(n){console.error("피드백 삭제 실패:",n),c({open:!0,message:"삭제 중 오류가 발생했습니다.",severity:"error"})}},y=bs(me),Se=s=>{M(s),I("approve"),v(!0)},we=s=>{M(s),I("reject"),v(!0)},Ae=async()=>{if(!(!j||!x)){if(x==="reject"&&!R.trim()){c({open:!0,message:"거부 시에는 사유를 입력해주세요.",severity:"error"});return}try{const s=x==="approve"?"approved":"rejected";await ds(j.id,s,R),c({open:!0,message:`${j.email}의 요청이 ${x==="approve"?"승인":"거부"}되었습니다.`,severity:"success"}),B()}catch{c({open:!0,message:"처리 중 오류가 발생했습니다.",severity:"error"})}finally{v(!1),M(null),I(null),E("")}}},G=()=>{c({...w,open:!1})},We=(s,n)=>{ce(n)},ke=()=>e.jsxs(l,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(h,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",height:"100%"},children:e.jsxs(g,{sx:{textAlign:"center"},children:[e.jsx(te,{sx:{fontSize:40,mb:1}}),e.jsx(t,{variant:"h4",fontWeight:"bold",children:N}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"현재 접속자"})]})})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(h,{sx:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",height:"100%"},children:e.jsxs(g,{sx:{textAlign:"center"},children:[e.jsx(ae,{sx:{fontSize:40,mb:1}}),e.jsx(t,{variant:"h4",fontWeight:"bold",children:b.pending}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"대기중 피드백"})]})})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(h,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",height:"100%"},children:e.jsxs(g,{sx:{textAlign:"center"},children:[e.jsx(J,{sx:{fontSize:40,mb:1}}),e.jsx(t,{variant:"h4",fontWeight:"bold",children:y.messagesThisHour}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"최근 1시간 채팅"})]})})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(h,{sx:{background:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",color:"white",height:"100%"},children:e.jsxs(g,{sx:{textAlign:"center"},children:[e.jsx(Ue,{sx:{fontSize:40,mb:1}}),e.jsx(t,{variant:"h4",fontWeight:"bold",children:S.filter(s=>s.status==="pending").length}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"승인 대기"})]})})})]}),Te=()=>e.jsx(h,{sx:{mb:3},children:e.jsxs(g,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(t,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(te,{color:"primary"}),"실시간 접속자 (",N,"명)"]}),e.jsx(P,{onClick:()=>window.location.reload(),children:e.jsx(Ye,{})})]}),z.length===0?e.jsx(t,{color:"text.secondary",sx:{textAlign:"center",py:3},children:"현재 접속한 사용자가 없습니다 😴"}):e.jsx(Ge,{children:z.map((s,n)=>e.jsxs(Je,{divider:n<z.length-1,children:[e.jsx(Ke,{children:e.jsx(Qe,{badgeContent:s.status==="online"?"🟢":"🟡",overlap:"circular",children:e.jsx(K,{src:s.photoURL,children:s.displayName.charAt(0)})})}),e.jsx(Ze,{primary:s.displayName,secondary:e.jsxs(a,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:s.email}),s.page&&e.jsxs(t,{variant:"caption",sx:{display:"block"},children:["📍 ",s.page]}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:["마지막 활동: ",s.lastSeen?C(s.lastSeen.toDate()).fromNow():"정보 없음"]})]})}),e.jsx(Ve,{children:e.jsx(f,{label:s.status==="online"?"온라인":"자리비움",size:"small",color:s.status==="online"?"success":"default"})})]},s.uid))})]})}),De=()=>e.jsx(h,{children:e.jsxs(g,{children:[e.jsxs(t,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ae,{color:"primary"}),"피드백 관리 (",b.total,"개)"]}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(l,{item:!0,xs:3,children:e.jsxs(m,{sx:{p:2,textAlign:"center",bgcolor:"grey.100"},children:[e.jsx(t,{variant:"h6",children:b.pending}),e.jsx(t,{variant:"caption",children:"대기"})]})}),e.jsx(l,{item:!0,xs:3,children:e.jsxs(m,{sx:{p:2,textAlign:"center",bgcolor:"info.light",color:"white"},children:[e.jsx(t,{variant:"h6",children:b.inProgress}),e.jsx(t,{variant:"caption",children:"진행중"})]})}),e.jsx(l,{item:!0,xs:3,children:e.jsxs(m,{sx:{p:2,textAlign:"center",bgcolor:"success.light",color:"white"},children:[e.jsx(t,{variant:"h6",children:b.completed}),e.jsx(t,{variant:"caption",children:"완료"})]})}),e.jsx(l,{item:!0,xs:3,children:e.jsxs(m,{sx:{p:2,textAlign:"center",bgcolor:"error.light",color:"white"},children:[e.jsx(t,{variant:"h6",children:b.rejected}),e.jsx(t,{variant:"caption",children:"거부"})]})})]}),e.jsx(Xe,{component:m,variant:"outlined",children:e.jsxs(_e,{size:"small",children:[e.jsx(qe,{children:e.jsxs(re,{children:[e.jsx(o,{children:"타입"}),e.jsx(o,{children:"제목"}),e.jsx(o,{children:"사용자"}),e.jsx(o,{children:"우선순위"}),e.jsx(o,{children:"상태"}),e.jsx(o,{children:"날짜"}),e.jsx(o,{children:"액션"})]})}),e.jsx(es,{children:he.slice(0,10).map(s=>e.jsxs(re,{hover:!0,children:[e.jsx(o,{children:e.jsx(f,{label:`${ne(s.type)} ${s.type}`,size:"small",variant:"outlined"})}),e.jsx(o,{children:e.jsx(ss,{title:s.description,children:e.jsx(t,{variant:"body2",noWrap:!0,sx:{maxWidth:200},children:s.title})})}),e.jsx(o,{children:s.userDisplayName}),e.jsx(o,{children:e.jsx(f,{label:s.priority,size:"small",sx:{backgroundColor:xs(s.priority),color:"white"}})}),e.jsx(o,{children:e.jsx(f,{label:s.status,size:"small",sx:{backgroundColor:hs(s.status),color:"white"}})}),e.jsx(o,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:s.createdAt?C(s.createdAt.toDate()).format("MM/DD HH:mm"):"날짜 정보 없음"})}),e.jsx(o,{children:e.jsxs(a,{sx:{display:"flex",gap:.5},children:[e.jsx(P,{size:"small",onClick:()=>{$(s),W(!0)},children:e.jsx(ts,{fontSize:"small"})}),e.jsx(P,{size:"small",color:"error",onClick:()=>Ce(s.id),children:e.jsx(as,{fontSize:"small"})})]})})]},s.id))})]})})]})});return e.jsx(ze,{in:!0,timeout:800,children:e.jsxs(a,{sx:{p:{xs:2,md:3},maxWidth:"1400px",mx:"auto"},children:[e.jsxs(a,{sx:{mb:4},children:[e.jsx(t,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:`${T==null?void 0:T.concepts.environment} 관리소`}),e.jsx(t,{variant:"body1",color:"text.secondary",children:"실시간 사용자 현황과 피드백을 관리하고 시스템을 모니터링하세요"})]}),ke(),e.jsx(m,{sx:{mb:3},children:e.jsxs(Be,{value:A,onChange:We,variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(L,{label:"🌐 실시간 현황"}),e.jsx(L,{label:"💬 피드백 관리"}),e.jsx(L,{label:"👥 사용자 승인"})]})}),A===0&&e.jsxs(a,{children:[Te(),e.jsx(h,{children:e.jsxs(g,{children:[e.jsxs(t,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(J,{color:"primary"}),"채팅 통계"]}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(m,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"📊 메시지 현황"}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(t,{variant:"body2",children:"총 메시지:"}),e.jsxs(t,{variant:"body2",fontWeight:"bold",children:[y.totalMessages,"개"]})]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(t,{variant:"body2",children:"최근 1시간:"}),e.jsxs(t,{variant:"body2",fontWeight:"bold",children:[y.messagesThisHour,"개"]})]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(t,{variant:"body2",children:"활성 사용자:"}),e.jsxs(t,{variant:"body2",fontWeight:"bold",children:[y.activeUsers,"명"]})]})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(m,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"🏆 인기 이모지"}),y.topEmojis.length>0?y.topEmojis.map((s,n)=>e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(t,{variant:"body2",children:s.emoji}),e.jsxs(t,{variant:"body2",fontWeight:"bold",children:[s.count,"회"]})]},s.emoji)):e.jsx(t,{variant:"body2",color:"text.secondary",children:"아직 이모지 사용 기록이 없습니다"})]})})]})]})})]}),A===1&&De(),A===2&&e.jsx(h,{sx:{overflow:"hidden"},children:e.jsxs(g,{sx:{p:0},children:[e.jsx(a,{sx:{p:3,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Fe,{sx:{fontSize:32}}),e.jsxs(a,{children:[e.jsx(t,{variant:"h5",fontWeight:"bold",children:"사용자 접근 요청 관리"}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"새로운 사용자의 접근 요청을 승인하거나 거부할 수 있습니다"})]})]})}),e.jsx(a,{sx:{p:3},children:oe?e.jsxs(a,{sx:{textAlign:"center",py:6},children:[e.jsx(Le,{sx:{mb:3,maxWidth:300,mx:"auto"}}),e.jsx(t,{color:"text.secondary",variant:"h6",children:"데이터를 불러오는 중..."}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"잠시만 기다려주세요 ⏳"})]}):S.length===0?e.jsxs(a,{sx:{textAlign:"center",py:6},children:[e.jsx(t,{variant:"h4",sx:{mb:2,opacity:.7},children:"🎉"}),e.jsx(t,{variant:"h6",gutterBottom:!0,color:"text.primary",children:"처리할 접근 요청이 없습니다"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"모든 요청이 처리되었거나 새로운 요청이 없습니다."})]}):e.jsxs(a,{children:[e.jsxs(t,{variant:"h6",sx:{mb:3,color:"text.primary"},children:["📋 접근 요청 목록 (",S.length,"건)"]}),e.jsx(a,{sx:{display:"flex",flexDirection:"column",gap:2},children:S.map((s,n)=>{var p;return e.jsx(Pe,{direction:"up",in:!0,timeout:300+n*100,children:e.jsx(h,{variant:"outlined",sx:{p:3,borderRadius:3,transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 25px rgba(0,0,0,0.12)",transform:"translateY(-2px)"},border:s.status==="pending"?"2px solid rgba(255,193,7,0.3)":s.status==="approved"?"2px solid rgba(76,175,80,0.3)":"2px solid rgba(244,67,54,0.3)",background:s.status==="pending"?"rgba(255,193,7,0.02)":s.status==="approved"?"rgba(76,175,80,0.02)":"rgba(244,67,54,0.02)"},children:e.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:3},children:[e.jsx(K,{src:s.photoURL,sx:{width:56,height:56,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:((p=s.displayName)==null?void 0:p.charAt(0))||s.email.charAt(0)}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(t,{variant:"h6",fontWeight:"bold",sx:{color:"text.primary"},children:s.displayName||"이름 없음"}),e.jsx(f,{icon:s.status==="pending"?e.jsx(Oe,{}):s.status==="approved"?e.jsx(Q,{}):e.jsx(Z,{}),label:s.status==="pending"?"대기중":s.status==="approved"?"승인됨":"거부됨",size:"small",variant:"filled",color:s.status==="pending"?"warning":s.status==="approved"?"success":"error",sx:{fontWeight:"bold",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}})]}),e.jsxs(t,{variant:"body1",color:"text.secondary",sx:{mb:1},children:["📧 ",s.email]}),s.reason&&e.jsxs(a,{sx:{p:2,bgcolor:"rgba(25,118,210,0.08)",borderRadius:2,border:"1px solid rgba(25,118,210,0.1)",mb:2},children:[e.jsx(t,{variant:"body2",sx:{fontWeight:"medium",mb:.5},children:"💬 요청 사유:"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:['"',s.reason,'"']})]}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5,fontWeight:"medium"},children:["🕒 요청일:"," ",s.createdAt?C(s.createdAt.toDate()).format("YYYY년 MM월 DD일 HH:mm"):"날짜 정보 없음"]})]}),s.status==="pending"&&e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:1,minWidth:120},children:[e.jsx(u,{variant:"contained",color:"success",size:"small",startIcon:e.jsx(Q,{}),onClick:()=>Se(s),sx:{fontWeight:"bold",boxShadow:"0 3px 10px rgba(76,175,80,0.3)","&:hover":{boxShadow:"0 5px 15px rgba(76,175,80,0.4)"}},children:"승인"}),e.jsx(u,{variant:"outlined",color:"error",size:"small",startIcon:e.jsx(Z,{}),onClick:()=>we(s),sx:{fontWeight:"bold",borderWidth:2,"&:hover":{borderWidth:2,boxShadow:"0 3px 10px rgba(244,67,54,0.3)"}},children:"거부"})]})]})})},s.id)})})]})})]})}),e.jsx(a,{sx:{mt:4,display:"flex",justifyContent:"center"},children:e.jsx(Ee,{control:e.jsx(Ne,{checked:U,onChange:s=>fe(s.target.checked),name:"maintenanceMode",color:"primary"}),label:e.jsxs(t,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{}),U?"점검 모드 ON":"점검 모드 OFF"]})})}),e.jsxs(V,{open:ue,onClose:()=>W(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{children:"💬 피드백 응답"}),e.jsx(_,{children:i&&e.jsxs(a,{sx:{mb:3},children:[e.jsxs(t,{variant:"h6",gutterBottom:!0,children:[ne(i.type)," ",i.title]}),e.jsxs(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["작성자: ",i.userDisplayName," (",i.userEmail,")"]}),e.jsx(t,{variant:"body1",sx:{mb:2,p:2,bgcolor:"grey.100",borderRadius:1},children:i.description}),e.jsx(q,{fullWidth:!0,multiline:!0,rows:4,label:"관리자 응답",placeholder:"사용자에게 보낼 응답을 작성해주세요...",value:k,onChange:s=>H(s.target.value),sx:{mb:2}})]})}),e.jsxs(ee,{children:[e.jsx(u,{onClick:()=>W(!1),children:"취소"}),e.jsx(u,{onClick:()=>F(i==null?void 0:i.id,"in-progress"),color:"info",children:"진행중으로 변경"}),e.jsx(u,{onClick:()=>F(i==null?void 0:i.id,"completed",k),color:"success",disabled:!k.trim(),children:"완료 처리"}),e.jsx(u,{onClick:()=>F(i==null?void 0:i.id,"rejected",k),color:"error",children:"거부"})]})]}),e.jsxs(V,{open:le,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(X,{children:x==="approve"?"✅ 접근 승인":"❌ 접근 거부"}),e.jsxs(_,{children:[j&&e.jsxs(a,{sx:{mb:2},children:[e.jsxs(t,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:j.displayName||"이름 없음"})," (",j.email,")의 접근을"," ",x==="approve"?"승인":"거부","하시겠습니까?"]}),j.reason&&e.jsx(se,{severity:"info",sx:{mt:2},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"요청 사유:"})," ",j.reason]})})]}),e.jsx(q,{fullWidth:!0,multiline:!0,rows:3,label:x==="approve"?"승인 메시지 (선택사항)":"거부 사유",placeholder:x==="approve"?"승인과 함께 전달할 메시지를 입력하세요...":"거부 사유를 입력하세요...",value:R,onChange:s=>E(s.target.value)})]}),e.jsxs(ee,{children:[e.jsx(u,{onClick:()=>v(!1),children:"취소"}),e.jsx(u,{onClick:Ae,variant:"contained",color:x==="approve"?"success":"error",children:x==="approve"?"승인":"거부"})]})]}),e.jsx(He,{open:w.open,autoHideDuration:6e3,onClose:G,children:e.jsx(se,{onClose:G,severity:w.severity,sx:{width:"100%"},children:w.message})})]})})};export{Ss as default};
