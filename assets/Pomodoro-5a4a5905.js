import{u as pe,n as je,a as r,j as t,B as x,T as d,ab as he,a6 as Q,a7 as q,bG as fe,X as Te,bH as be,F as Nt,I as Yt,S as Et,M as Ft,f as T,aF as Rt,L as Se,q as ge,aI as ve,aK as Ie,C as ye,A as Wt,ag as ke,ai as we,ah as Me,o as Ae,aj as De,am as Be,_ as Pe,D as zt,b as Lt,c as Ut,d as ct,e as Ht}from"./mui-1d16f996.js";import{R as Oe,S as Ne,T as Ye,U as Ee,a as Fe,g as X,i as dt,l as Re}from"./index-3e7966b4.js";import"./dayjs-9d6a636c.js";const Ge=({themeConfig:i})=>{var At,Dt,Bt,Pt;const Z=pe(),D=je(Z.breakpoints.down("md")),B=Oe(i),k=Ne(i);Ye(i);const{isActive:_,time:K,totalTime:V,selectedProject:tt,selectedTask:et,isBreak:st,completedSessions:at,sessionStartTime:We,currentSessionId:ze,startTimer:Jt,pauseTimer:$t,resetTimer:Ct,setTime:ut,setProject:rt,setTask:P,setIsBreak:Le}=Ee(),{projects:O,addProject:Gt,addTodo:Qt,getTodosByProjectId:xt,toggleTodoComplete:qt}=Fe(),[m,w]=r.useState(_),[l,N]=r.useState(Math.floor(V/60)),[j,b]=r.useState(K),[o,R]=r.useState(tt),[n,M]=r.useState(et),[Ue,Xt]=r.useState([]),[S,W]=r.useState(st),[Zt,mt]=r.useState(at),[He,ot]=r.useState({}),p=r.useRef(null),A=r.useRef(0),it=r.useRef(0),[pt,nt]=r.useState({x:50,y:50}),[jt,ht]=r.useState([]),[v,z]=r.useState(null),[h,L]=r.useState(null),[U,I]=r.useState(null),[_t,ft]=r.useState(!1),[f,Kt]=r.useState(null),[Vt,H]=r.useState(!1),[te,J]=r.useState(!1),[Y,Tt]=r.useState(""),[bt,St]=r.useState(""),[E,gt]=r.useState(""),$=r.useRef(null),g=r.useRef(!1);r.useEffect(()=>{w(_),b(K),R(tt),M(et??null),W(st),mt(at),N(Math.floor(V/60))},[_,K,tt,et,st,at,V]),r.useEffect(()=>{Xt(O)},[O]),r.useEffect(()=>{ce();try{$.current=new Audio,$.current.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZgdT32YorBjOH3vbYhTYEJYHU99uLNwgYgtD32YcrBTOH2vbYgzUEJYHW99uLNwgWgdD32YorBTOH2vbYgzQEJYPY99uLNwgXgdP32YcrBDOG2fXWgTYEJ4LS9dqMNwcUgNP32I0qBjOH3fVwKdOoAo+OgNT22I0qBjOE0/TUmzEGFYDO9dyIKwUzhdj42YYz6DOEz/TQjC8UgNP32IsyBjOH3fXYyDQODYHQ8teBONQ4HoPU9tyIrSoGLYHO9diJNwgZgdT32YorBmQ"}catch(e){console.warn("알림 사운드 초기화 실패:",e)}},[]),r.useEffect(()=>{m||b(l*60)},[l,m]),r.useEffect(()=>{let e=null,s=null;return m&&j>0?(g.current=!1,e=setInterval(()=>{b(a=>{const c=a-1,u=l*60,y=(u-c)/u*100;return vt(y),c})},1e3),s=setInterval(()=>{kt()},5e3)):j===0&&(g.current||yt()),()=>{e&&clearInterval(e),s&&clearInterval(s)}},[m,j,l]),r.useEffect(()=>{if(!m)return;const s=setInterval(()=>{const c=(l*60-j)/60*2*Math.PI,u=35,y=50,Ot=50,C=y+Math.cos(c-Math.PI/2)*u,G=Ot+Math.sin(c-Math.PI/2)*u;nt({x:C,y:G})},100);return()=>clearInterval(s)},[m,j,l]),r.useEffect(()=>{lt()},[l]);const lt=()=>{const s=[];for(let a=0;a<60;a++)s.push({id:a,angle:a*360/60,filled:!1});ht(s)},vt=e=>{const a=Math.floor(e/100*60);ht(c=>c.map((u,y)=>({...u,filled:y<a})))},ee=async()=>{try{const e=X();if(e){const s=await Re(e.uid,"projectTodos");s.success&&s.data&&ot(s.data)}else{const s=localStorage.getItem("projectTodos");if(s){const a=JSON.parse(s);ot(a)}}}catch{const s=localStorage.getItem("projectTodos");if(s){const a=JSON.parse(s);ot(a)}}},se=async()=>{Y.trim()&&(await Gt({title:Y.trim(),description:bt.trim(),status:"active",priority:"medium",progress:0},void 0),setTimeout(()=>{const e=O.find(s=>s.title===Y.trim());e&&(R(e),rt(e))},300),Tt(""),St(""),H(!1))},ae=async()=>{if(!E.trim()||!o)return;await Qt({title:E.trim(),description:"",completed:!1,priority:"medium",dueDate:void 0,tags:[],projectId:o.id,epicId:void 0});const s=xt(o.id).filter(a=>!a.completed).find(a=>a.title===E.trim());s&&(M(s),P(s)),gt(""),J(!1)},re=async e=>{await qt(e.id),(n==null?void 0:n.id)===e.id&&!e.completed&&(M(null),P(null))},oe=e=>{const s=Math.floor(e/60),a=e%60;return`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},ie=()=>{if(!o||!n){alert("프로젝트와 작업을 선택해주세요!");return}if(rt(o),P(n),ut(l),!Jt()){alert("타이머 시작에 실패했습니다. 프로젝트와 작업을 다시 확인해주세요.");return}w(!0);const s=Date.now(),a=new Date().toISOString(),c=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;z(a),L(c),I(null),g.current=!1,p.current=s,A.current=j,it.current=s,lt(),setTimeout(()=>kt(),100)},ne=()=>{var e;if($t(),p.current){const s=Date.now(),a=Math.floor((s-p.current)/1e3),c=Math.max(0,A.current-a);if(a>0&&h&&U!==h&&v&&o&&n){const u=Math.round(a/60*100)/100;dt(((e=X())==null?void 0:e.uid)||"",{projectId:o.id,projectTitle:o.title,taskId:n.id,taskTitle:n.title,sessionType:S?"break":"work",duration:l,actualDuration:u,startTime:v,endTime:new Date().toISOString(),completed:!1}),I(h)}b(c)}w(!1),p.current=null,A.current=0,localStorage.removeItem("pomodoroTimerState")},It=()=>{var a;Ct();const e=m,s=p.current?Math.floor((Date.now()-p.current)/1e3):0;if(e&&s>0&&h&&U!==h&&v&&o&&n){const c=Math.round(s/60*100)/100;dt(((a=X())==null?void 0:a.uid)||"",{projectId:o.id,projectTitle:o.title,taskId:n.id,taskTitle:n.title,sessionType:S?"break":"work",duration:l,actualDuration:c,startTime:v,endTime:new Date().toISOString(),completed:!1}),I(h)}w(!1),b(l*60),z(null),L(null),I(null),g.current=!1,nt({x:50,y:50}),p.current=null,A.current=0,it.current=0,localStorage.removeItem("pomodoroTimerState"),lt()},le=()=>{try{if("Notification"in window&&Notification.permission==="granted"&&new Notification("🎉 뽀모도로 완료!",{body:`${l}분 집중 완료! 수고하셨어요!`,icon:"/favicon.ico"}),$.current)for(let e=0;e<3;e++)setTimeout(()=>{var s;(s=$.current)==null||s.play().catch(()=>{})},e*200);"vibrate"in navigator&&navigator.vibrate([500,200,500,200,500])}catch{}},yt=async()=>{if(g.current)return;g.current=!0;const e=p.current?Math.floor((Date.now()-p.current)/1e3):l*60,s=Math.round(e/60*100)/100;if(w(!1),le(),h&&U!==h&&v&&o&&n)try{const a=X();if(a){const c={projectId:o.id,projectTitle:o.title,taskId:n.id,taskTitle:n.title,sessionType:S?"break":"work",duration:l,actualDuration:s,startTime:v,endTime:new Date().toISOString(),completed:!0};(await dt(a.uid,c)).success&&(I(h),Kt({projectTitle:o.title,taskTitle:n.title,sessionType:S?"휴식":"집중",duration:l,actualMinutes:s}),ft(!0),setTimeout(()=>ft(!1),5e3))}}catch{}if(S)W(!1),N(25),b(25*60),g.current=!1;else{mt(c=>c+1),W(!0);const a=Math.max(5,Math.floor(l/5));N(a),b(a*60),g.current=!1}p.current=null,A.current=0,it.current=0,L(null),I(null),localStorage.removeItem("pomodoroTimerState"),z(null)};r.useEffect(()=>{"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()},[]);const kt=()=>{if(m&&p.current){const e={isActive:m,startTime:p.current,totalDuration:A.current,currentTime:j,selectedMinutes:l,sessionStartTime:v,isBreak:S,selectedProjectId:o==null?void 0:o.id,selectedTaskId:n==null?void 0:n.id,selectedProjectTitle:o==null?void 0:o.title,selectedTaskTitle:n==null?void 0:n.title,currentSessionId:h,savedSessionId:U,timestamp:Date.now()};localStorage.setItem("pomodoroTimerState",JSON.stringify(e))}},ce=()=>{try{const e=localStorage.getItem("pomodoroTimerState");if(!e)return;const s=JSON.parse(e),a=Date.now();if(a-s.timestamp>2*60*60*1e3){localStorage.removeItem("pomodoroTimerState");return}if(s.isActive&&s.startTime){const c=Math.floor((a-s.startTime)/1e3),u=Math.max(0,s.totalDuration-c);if(u>0){s.selectedProjectId&&s.selectedProjectTitle&&R({id:s.selectedProjectId,title:s.selectedProjectTitle,description:"",status:"active",priority:"medium",progress:0,tasks:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),s.selectedTaskId&&s.selectedTaskTitle&&M({id:s.selectedTaskId,title:s.selectedTaskTitle,completed:!1,createdAt:new Date().toISOString()}),w(!0),b(u),N(s.selectedMinutes),z(s.sessionStartTime),W(s.isBreak),L(s.currentSessionId||null),I(s.savedSessionId||null);const y=(s.totalDuration-u)/s.totalDuration*100;vt(y);const C=(s.selectedMinutes*60-u)/60*2*Math.PI,G=35,de=50,ue=50,xe=de+Math.cos(C-Math.PI/2)*G,me=ue+Math.sin(C-Math.PI/2)*G;nt({x:xe,y:me})}else localStorage.removeItem("pomodoroTimerState"),yt()}}catch{localStorage.removeItem("pomodoroTimerState")}},F=o?xt(o.id).filter(e=>!e.completed):[],wt=(l*60-j)/(l*60)*100,Mt=jt.filter(e=>e.filled).length;return t.jsxs(x,{sx:{p:D?2:3},children:[t.jsxs(x,{sx:{mb:4},children:[t.jsx(d,{variant:D?"h5":"h4",fontWeight:"bold",gutterBottom:!0,sx:{WebkitBackgroundClip:"text",display:"flex",alignItems:"center",gap:1},children:"🧭 집중 여행"}),t.jsxs(d,{variant:"body1",color:"textSecondary",children:["집중할 시간을 선택하고 ",(At=i==null?void 0:i.concepts)==null?void 0:At.animal,"과 함께 집중해보세요! ",i==null?void 0:i.emoji,"⭐️"]})]}),t.jsxs(x,{sx:{display:"flex",flexDirection:D?"column":"row",gap:3},children:[t.jsx(he,{in:_t,children:t.jsx(Q,{sx:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:9999,minWidth:D?300:400,background:B.background.gradient,color:"white",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:t.jsxs(q,{sx:{textAlign:"center",py:4},children:[t.jsx(fe,{sx:{fontSize:80,mb:2,color:"#FFD700"}}),t.jsx(d,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"🎉 완료!"}),f&&t.jsxs(t.Fragment,{children:[t.jsxs(d,{variant:"h6",sx:{mb:2,opacity:.9},children:[f.duration,"분 ",f.sessionType," 세션 완료",f.actualMinutes&&f.actualMinutes!==f.duration&&t.jsxs(d,{variant:"body2",sx:{opacity:.7,mt:.5},children:["(실제 ",f.actualMinutes,"분 집중)"]})]}),t.jsxs(x,{sx:{bgcolor:"rgba(255,255,255,0.2)",borderRadius:2,p:2,mb:2,backdropFilter:"blur(10px)"},children:[t.jsxs(d,{variant:"body1",fontWeight:"bold",children:["📁 ",f.projectTitle]}),t.jsxs(d,{variant:"body2",sx:{opacity:.8},children:["✅ ",f.taskTitle]})]}),t.jsx(d,{variant:"body2",sx:{opacity:.7},children:k.building.completionMessage})]})]})})}),t.jsx(Q,{sx:{flex:1,maxWidth:D?"100%":400},children:t.jsxs(q,{children:[t.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Te,{color:"primary"})," 작업 설정"]}),t.jsxs(x,{sx:{mb:3},children:[t.jsxs(d,{variant:"subtitle2",gutterBottom:!0,children:["집중 시간: ",l,"분"]}),t.jsx(be,{value:l,onChange:(e,s)=>{N(s),ut(s)},min:1,max:99,step:1,disabled:m,marks:[{value:1,label:"1분"},{value:10,label:"10분"},{value:25,label:"25분"},{value:50,label:"50분"},{value:99,label:"99분"}],sx:{"& .MuiSlider-thumb":{background:B.border.color},"& .MuiSlider-track":{background:B.background.gradient}}})]}),t.jsxs(Nt,{fullWidth:!0,sx:{mb:2},children:[t.jsx(Yt,{children:"프로젝트 선택"}),t.jsx(Et,{value:(o==null?void 0:o.id)||"",label:"프로젝트 선택",onChange:e=>{const s=O.find(a=>a.id===e.target.value);R(s||null),rt(s||null),M(null),P(null),s&&ee()},children:O.map(e=>t.jsx(Ft,{value:e.id,children:e.title},e.id))})]}),t.jsx(T,{variant:"outlined",startIcon:t.jsx(Rt,{}),onClick:()=>H(!0),sx:{mb:2,width:"100%"},children:"새 프로젝트 만들기"}),o&&t.jsxs(t.Fragment,{children:[t.jsxs(Nt,{fullWidth:!0,sx:{mb:2},children:[t.jsx(Yt,{children:"태스크 선택"}),t.jsx(Et,{value:(n==null?void 0:n.id)||"",label:"태스크 선택",onChange:e=>{const s=F.find(a=>a.id===e.target.value);M(s||null),P(s||null)},children:F.map(e=>t.jsx(Ft,{value:e.id,children:e.title},e.id))})]}),t.jsx(T,{variant:"outlined",startIcon:t.jsx(Rt,{}),onClick:()=>J(!0),sx:{mb:2,width:"100%"},children:"새 테스크 만들기"}),F.length>0&&t.jsxs(x,{sx:{mb:2},children:[t.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"테스크 목록:"}),t.jsx(Se,{dense:!0,children:F.map(e=>t.jsx(ge,{sx:{px:0},children:t.jsx(ve,{control:t.jsx(Ie,{checked:e.completed,onChange:()=>re(e),size:"small"}),label:t.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(d,{variant:"body2",sx:{textDecoration:e.completed?"line-through":"none",opacity:e.completed?.6:1},children:e.title}),e.completed&&t.jsx(ye,{label:"완료",size:"small",color:"success"})]}),sx:{flex:1,m:0}})},e.id))})]})]}),o&&F.length===0&&t.jsx(Wt,{severity:"info",sx:{mb:2},children:t.jsxs(d,{variant:"body2",children:["📝 완료되지 않은 테스크가 없어요!",t.jsx("br",{}),"새 테스크를 만들거나 ",(Dt=i==null?void 0:i.concepts)==null?void 0:Dt.projectType,"에서 할일을 추가해보세요!"," ",i==null?void 0:i.emoji]})}),t.jsx(Wt,{severity:S?"info":"success",sx:{mb:2},children:S?"🌵 휴식 시간입니다!":`${i==null?void 0:i.emoji} 집중 시간입니다!`}),t.jsxs(d,{variant:"body2",color:"text.secondary",children:["완료된 세션: ",Zt,"개 🎯"]}),t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[k.blocks.collectName,": ",Mt,"/60개 ",k.blocks.emoji]})]})}),t.jsxs(x,{sx:{flex:1},children:[t.jsx(Q,{sx:{mb:3},children:t.jsxs(q,{sx:{textAlign:"center"},children:[t.jsx(d,{variant:"h2",fontWeight:"bold",color:"primary",sx:{mb:2},children:oe(j)}),t.jsx(ke,{variant:"determinate",value:wt,sx:{height:12,borderRadius:6,mb:3,"& .MuiLinearProgress-bar":{borderRadius:6,background:B.background.gradient}}}),t.jsxs(x,{sx:{display:"flex",justifyContent:"center",gap:1,flexWrap:"wrap"},children:[m?t.jsx(T,{variant:"contained",startIcon:t.jsx(Me,{}),onClick:ne,size:"large",color:"warning",children:"일시정지"}):t.jsx(T,{variant:"contained",startIcon:t.jsx(we,{}),onClick:ie,size:"large",disabled:!n,children:"시작"}),t.jsx(Ae,{onClick:It,size:"large",children:t.jsx(De,{})}),wt>=100&&t.jsx(T,{variant:"contained",startIcon:t.jsx(Be,{}),color:"success",size:"large",onClick:It,children:"완료! 🎉"})]})]})}),t.jsx(Q,{children:t.jsxs(q,{children:[t.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{textAlign:"center"},children:[t.jsx(Pe,{})," ⏱️ 집중 여행"]}),t.jsxs(x,{sx:{width:"100%",aspectRatio:"1 / 1",maxWidth:{xs:250,sm:300,md:400},margin:"0 auto",position:"relative",borderRadius:2,border:`2px solid ${Z.palette.divider}`,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:Z.palette.background.paper},children:[t.jsx(x,{sx:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",border:`2px solid ${B.border.color}`,borderRadius:"50%",transform:"translate(-50%, -50%)",zIndex:1}}),jt.map(e=>{const s=(e.angle-90)*(Math.PI/180),a=35,c=50+Math.cos(s)*a,u=50+Math.sin(s)*a;return t.jsx(x,{sx:{position:"absolute",left:`${c}%`,top:`${u}%`,width:"16px",height:"16px",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",transform:"translate(-50%, -50%)",opacity:e.filled?1:.3,transition:"opacity 0.5s ease",zIndex:2},children:e.filled?k.blocks.emoji:"⚪"},e.id)}),t.jsx(x,{sx:{position:"absolute",left:`${pt.x}%`,top:`${pt.y}%`,transform:"translate(-50%, -50%)",fontSize:"2rem",zIndex:3,filter:"drop-shadow(2px 2px 4px rgba(0,0,0,0.3))",transition:"all 0.1s ease-out"},children:i==null?void 0:i.emoji})]}),t.jsx(d,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mt:2},children:m?t.jsxs(t.Fragment,{children:["🎯 원을 따라 여행하는 ",(Bt=i==null?void 0:i.concepts)==null?void 0:Bt.animal,", ",k.blocks.type," 수집중! ",t.jsx("br",{}),"⏰"," ",Math.floor(j/60),"분 ",j%60,"초 남았어요! 원이 모두 채워지면 완료! ",t.jsx("br",{}),"🔄 1분에 한바퀴씩 돌며 ",Mt,"/60개 수집했어요!"]}):t.jsxs(t.Fragment,{children:[i==null?void 0:i.emoji," 출발을 기다리고 있는 ",(Pt=i==null?void 0:i.concepts)==null?void 0:Pt.animal,"! ",t.jsx("br",{}),"▶️ 타이머를 시작하면 원을 따라 여행하며 ",k.blocks.type," 수집 시작! ",t.jsx("br",{}),"⭕ 원이 모두 채워지면 ",l,"분 집중 완료!"]})})]})})]})]}),t.jsxs(zt,{open:Vt,onClose:()=>H(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(Lt,{children:"새 프로젝트 만들기"}),t.jsxs(Ut,{children:[t.jsx(ct,{autoFocus:!0,margin:"dense",label:"프로젝트 제목",fullWidth:!0,variant:"outlined",value:Y,onChange:e=>Tt(e.target.value),sx:{mb:2}}),t.jsx(ct,{margin:"dense",label:"프로젝트 설명 (선택사항)",fullWidth:!0,multiline:!0,rows:3,variant:"outlined",value:bt,onChange:e=>St(e.target.value)})]}),t.jsxs(Ht,{children:[t.jsx(T,{onClick:()=>H(!1),children:"취소"}),t.jsx(T,{onClick:se,variant:"contained",disabled:!Y.trim(),children:"만들기"})]})]}),t.jsxs(zt,{open:te,onClose:()=>J(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(Lt,{children:"새 테스크 만들기"}),t.jsxs(Ut,{children:[t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["프로젝트: ",o==null?void 0:o.title]}),t.jsx(ct,{autoFocus:!0,margin:"dense",label:"테스크 제목",fullWidth:!0,variant:"outlined",value:E,onChange:e=>gt(e.target.value)})]}),t.jsxs(Ht,{children:[t.jsx(T,{onClick:()=>J(!1),children:"취소"}),t.jsx(T,{onClick:ae,variant:"contained",disabled:!E.trim(),children:"만들기"})]})]})]})};export{Ge as default};
