import{u as xe,a as p,j as t,B as i,T as d,f as j,aN as Q,G as z,a6 as H,a7 as U,C as pe,aO as he,Y as ge,J as fe,D as je,b as be,c as ye,aP as Ce,d as ve,e as Se}from"./mui-754dcb1a.js";import{d as u}from"./dayjs-9d6a636c.js";import{g as V,l as ke,s as we}from"./index-bf293548.js";const Ye=({themeConfig:y})=>{var P,X,q;const r=xe(),[g,A]=p.useState(u().startOf("week")),[C,v]=p.useState([]),[x,W]=p.useState(null),[R,S]=p.useState(!1),[Y,T]=p.useState(""),F=p.useRef(null),[E,Z]=p.useState(!1),[B,ee]=p.useState(null),D=(()=>{switch(y==null?void 0:y.id){case"desert-fox":return{excellent:"🦊",good:"🌵",normal:"☀️",tired:"🏜️",exhausted:"🔥"};case"sheep":return{excellent:"🐑",good:"🌿",normal:"🌱",tired:"🍃",exhausted:"🌾"};case"cat":return{excellent:"🐱",good:"🐟",normal:"🧶",tired:"🐾",exhausted:"😿"};default:return{excellent:"🐧",good:"🐟",normal:"❄️",tired:"🧊",exhausted:"🐻‍❄️"}}})(),$=[{level:"excellent",emoji:D.excellent,color:"#4caf50",label:"최고"},{level:"good",emoji:D.good,color:"#8bc34a",label:"좋음"},{level:"normal",emoji:D.normal,color:"#ffc107",label:"보통"},{level:"tired",emoji:D.tired,color:"#ff9800",label:"피곤"},{level:"exhausted",emoji:D.exhausted,color:"#f44336",label:"매우 피곤"}],te=Array.from({length:24},(e,o)=>o),G=Array.from({length:7},(e,o)=>g.add(o,"day"));p.useEffect(()=>{oe()},[g]);const oe=async()=>{try{const e=V();if(e){const o=await ke(e.uid,"conditions");o.success&&o.data?v(o.data):v([])}else{const o=localStorage.getItem("conditions");v(o?JSON.parse(o):[])}}catch(e){console.error("컨디션 데이터 로드 실패:",e),v([])}},J=async e=>{try{const o=V();o?await we(o.uid,"conditions",e):localStorage.setItem("conditions",JSON.stringify(e))}catch(o){console.error("컨디션 데이터 저장 실패:",o)}},L=(e,o)=>C.find(a=>a.date===e&&a.hour===o),re=async e=>{if(!x)return;const o=L(x.date,x.hour);let a;if(o)a=C.map(s=>s.id===o.id?{...s,condition:e,memo:Y,updatedAt:new Date().toISOString()}:s);else{const s={id:Date.now().toString(),date:x.date,hour:x.hour,condition:e,memo:Y,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};a=[...C,s]}v(a),await J(a),S(!1),W(null),T("")},ae=async()=>{if(!x)return;const e=L(x.date,x.hour);if(e){const o=C.map(a=>a.id===e.id?{...a,memo:Y,updatedAt:new Date().toISOString()}:a);v(o),await J(o)}S(!1),W(null),T("")};p.useEffect(()=>{const e=u(),o=e.format("YYYY-MM-DD"),a=e.hour();W({date:o,hour:a}),S(!0)},[]),p.useEffect(()=>{if(R){const e=setTimeout(()=>{var o;return(o=F.current)==null?void 0:o.focus()},100);return()=>clearTimeout(e)}},[R]);const f=e=>$.find(o=>o.level===e),ne={excellent:5,good:4,normal:3,tired:2,exhausted:1},se=e=>e>=4.5?"excellent":e>=3.5?"good":e>=2.5?"normal":e>=1.5?"tired":"exhausted",N=e=>{const o=u().subtract(3,"week"),a=C.filter(l=>l.hour===e);if(a.length===0)return{counts:{excellent:0,good:0,normal:0,tired:0,exhausted:0},averageLevel:null,hasThreeWeeksData:!1};const s=a.reduce((l,m)=>u(m.date).isBefore(l)?u(m.date):l,u(a[0].date)),n=s.isBefore(o)||s.isSame(o,"day"),c=a.filter(l=>u(l.date).isAfter(o)||u(l.date).isSame(o,"day")),b=c.reduce((l,m)=>(l[m.condition]=(l[m.condition]??0)+1,l),{excellent:0,good:0,normal:0,tired:0,exhausted:0});if(!n||c.length===0)return{counts:b,averageLevel:null,hasThreeWeeksData:n};const I=Object.entries(b).reduce((l,[m,M])=>l+ne[m]*M,0),h=Object.values(b).reduce((l,m)=>l+m,0),w=h>0?I/h:0,O=h>0?se(w):null;return{counts:b,averageLevel:O,hasThreeWeeksData:n}},ie=(e,o,a)=>{W({date:e,hour:o}),T((a==null?void 0:a.memo)??"");const s=N(o);ee(s.hasThreeWeeksData?s.averageLevel:null),S(!0)},_=e=>[r.palette.error.main+"08",r.palette.info.main+"08",r.palette.success.main+"08",r.palette.warning.main+"08",r.palette.secondary.main+"08",r.palette.primary.main+"08",r.palette.grey[500]+"08"][e]||r.palette.grey[100],k=e=>[r.palette.error.main,r.palette.info.main,r.palette.success.main,r.palette.warning.main,r.palette.secondary.main,r.palette.primary.main,r.palette.grey[600]][e]||r.palette.text.primary,le=(e,o)=>{const a=o!==void 0?_(o):"transparent";if(!e)return a;const s=f(e.condition);return s?`linear-gradient(135deg, ${s.color}30, ${a})`:a},de=()=>{const e=g.format("YYYY-MM-DD"),o=g.add(6,"day").format("YYYY-MM-DD"),a=C.filter(n=>n.date>=e&&n.date<=o),s=$.reduce((n,c)=>(n[c.level]=a.filter(b=>b.condition===c.level).length,n),{});return{weekConditions:a,conditionCounts:s}},{weekConditions:ce,conditionCounts:ue}=de();return t.jsxs(i,{sx:{p:3},children:[t.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[t.jsxs(i,{children:[t.jsx(d,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"💚 컨디션 체크"}),t.jsxs(d,{variant:"body1",color:"textSecondary",children:[((P=y==null?void 0:y.concepts)==null?void 0:P.animal)||"동물","처럼 시간별 컨디션을 기록하고 패턴을 분석해보세요"]})]}),t.jsxs(i,{sx:{display:"flex",gap:2,alignItems:"center"},children:[t.jsx(j,{startIcon:t.jsx(Q,{}),onClick:()=>A(g.subtract(1,"week")),children:"이전 주"}),t.jsx(j,{variant:"contained",onClick:()=>A(u().startOf("week")),children:"이번 주"}),t.jsx(j,{startIcon:t.jsx(Q,{}),onClick:()=>A(g.add(1,"week")),children:"다음 주"}),t.jsx(j,{variant:E?"contained":"outlined",onClick:()=>Z(e=>!e),children:"누적 보기"})]})]}),t.jsxs(z,{container:!0,spacing:3,sx:{mb:4},children:[t.jsx(z,{item:!0,xs:12,md:8,children:t.jsx(H,{children:t.jsxs(U,{children:[t.jsxs(d,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:["📊 이번 주 통계 (",g.format("MM/DD")," - ",g.add(6,"day").format("MM/DD"),")"]}),t.jsx(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:$.map(e=>t.jsx(pe,{label:`${e.emoji} ${e.label}: ${ue[e.level]}회`,sx:{bgcolor:e.color+"20",color:e.color,fontWeight:500}},e.level))}),t.jsxs(d,{variant:"body2",color:"textSecondary",sx:{mt:2},children:["총 ",ce.length,"개의 컨디션이 기록되었습니다"]})]})})}),t.jsx(z,{item:!0,xs:12,md:4,children:t.jsx(H,{children:t.jsxs(U,{sx:{textAlign:"center"},children:[t.jsx(he,{sx:{fontSize:40,color:r.palette.primary.main,mb:1}}),t.jsx(d,{variant:"h6",gutterBottom:!0,children:"주간 평균"}),t.jsx(d,{variant:"h4",color:"primary",children:"3.2/5"}),t.jsx(j,{size:"small",startIcon:t.jsx(ge,{}),sx:{mt:1},children:"분석 보기"})]})})})]}),t.jsx(H,{children:t.jsxs(U,{children:[t.jsx(d,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"🗓️ 시간별 컨디션 그리드"}),t.jsx(i,{sx:{display:"flex",gap:1,mb:3,flexWrap:"wrap"},children:$.map(e=>t.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[t.jsx(i,{sx:{width:16,height:16,backgroundColor:e.color+"30",border:`2px solid ${e.color}`,borderRadius:1}}),t.jsxs(d,{variant:"caption",children:[e.emoji," ",e.label]})]},e.level))}),t.jsx(i,{sx:{overflowX:"auto",position:"relative",maxHeight:"70vh",overflowY:"auto"},children:t.jsxs(i,{sx:{minWidth:800},children:[t.jsxs(i,{sx:{display:"grid",gridTemplateColumns:"80px repeat(7, 1fr)",gap:1,mb:1,position:"sticky",top:0,backgroundColor:r.palette.background.paper,zIndex:10,borderBottom:`2px solid ${r.palette.divider}`,pb:1},children:[t.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",backgroundColor:r.palette.mode==="dark"?r.palette.background.paper:r.palette.grey[100],borderRadius:1,border:`1px solid ${r.palette.divider}`},children:t.jsx(d,{variant:"caption",fontWeight:"bold",children:"시간"})}),G.map((e,o)=>t.jsxs(i,{sx:{textAlign:"center",p:1.5,backgroundColor:_(o),borderRadius:2,border:`2px solid ${k(o)}30`,boxShadow:1},children:[t.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:k(o)},children:e.format("ddd")}),t.jsx(d,{variant:"caption",sx:{color:k(o),opacity:.8,display:"block",mt:.5},children:e.format("MM/DD")}),e.isSame(u(),"day")&&t.jsx(i,{sx:{width:6,height:6,backgroundColor:k(o),borderRadius:"50%",mx:"auto",mt:.5}})]},e.format("YYYY-MM-DD")))]}),te.map(e=>t.jsxs(i,{sx:{display:"grid",gridTemplateColumns:"80px repeat(7, 1fr)",gap:1,mb:1,"&:hover":{"& > div":{transform:"scale(1.01)",transition:"transform 0.1s ease"}}},children:[t.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"center",p:1,backgroundColor:r.palette.mode==="dark"?r.palette.background.paper:r.palette.grey[50],borderRadius:1,border:`1px solid ${r.palette.divider}`,position:"sticky",left:0,zIndex:5,minHeight:50},children:t.jsxs(d,{variant:"body2",fontWeight:"bold",sx:{color:r.palette.text.primary},children:[e.toString().padStart(2,"0"),":00"]})}),G.map((o,a)=>{var l,m;const s=o.format("YYYY-MM-DD"),n=L(s,e),c=n?f(n.condition):null,I=o.isSame(u(),"day")&&e===u().hour(),h=E?N(e):null,w=h!=null&&h.averageLevel?f(h.averageLevel):null,O=h?Object.entries(h.counts).filter(([,M])=>M>0).map(([M,me])=>{var K;return`${(K=f(M))==null?void 0:K.emoji}x${me}`}).join(" · "):null;return t.jsx(fe,{title:n?`${o.format("ddd")} ${e}시 - ${c==null?void 0:c.emoji} ${c==null?void 0:c.label}${n.memo?` - ${n.memo}`:""}${w?`
과거 ${e}시 요약: ${O}`:""}`:`${o.format("ddd")} ${e}시 - 컨디션 기록하기${w?`
과거 ${e}시 요약: ${O}`:""}`,arrow:!0,children:t.jsxs(i,{onClick:()=>ie(s,e,n),sx:{minHeight:50,backgroundColor:le(n,a),border:n?`3px solid ${((l=f(n.condition))==null?void 0:l.color)||r.palette.divider}`:`2px solid ${k(a)}20`,borderRadius:2,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",transition:"all 0.2s ease","&:hover":{transform:"scale(1.05)",boxShadow:2,borderColor:n?(m=f(n.condition))==null?void 0:m.color:k(a)},...I&&{boxShadow:`0 0 0 3px ${r.palette.primary.main}40`,borderColor:r.palette.primary.main}},children:[n&&c&&t.jsx(d,{sx:{fontSize:"1.5rem"},children:c.emoji}),!n&&w&&E&&t.jsx(d,{sx:{fontSize:"1.2rem",opacity:.6},children:w.emoji}),I&&t.jsx(i,{sx:{position:"absolute",top:2,right:2,width:8,height:8,backgroundColor:r.palette.primary.main,borderRadius:"50%",animation:"pulse 2s infinite"}}),(n==null?void 0:n.memo)&&t.jsx(i,{sx:{position:"absolute",bottom:2,left:2,width:6,height:6,backgroundColor:r.palette.info.main,borderRadius:"50%"}})]})},`${s}-${e}`)})]},e))]})})]})}),t.jsxs(je,{open:R,onClose:()=>S(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(be,{children:x&&`컨디션 기록 - ${u(x.date).format("MM/DD")} ${x.hour.toString().padStart(2,"0")}:00`}),t.jsxs(ye,{children:[B&&t.jsxs(d,{variant:"body2",sx:{mb:1},children:["추천 기본값: ",(X=f(B))==null?void 0:X.emoji," ",(q=f(B))==null?void 0:q.label]}),t.jsx(d,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"컨디션을 선택하세요:"}),t.jsx(Ce,{variant:"outlined",sx:{mb:3,flexWrap:"wrap"},children:$.map(e=>t.jsxs(j,{onClick:()=>re(e.level),sx:{bgcolor:e.color+"20",borderColor:e.color,color:e.color,"&:hover":{bgcolor:e.color+"30",borderColor:e.color},...B===e.level&&{boxShadow:`0 0 0 2px ${e.color}80 inset`}},children:[e.emoji," ",e.label]},e.level))}),t.jsx(ve,{inputRef:F,autoFocus:!0,fullWidth:!0,multiline:!0,rows:3,label:"메모 (선택사항)",placeholder:"컨디션에 대한 상세한 기록을 남겨보세요...",value:Y,onChange:e=>T(e.target.value)})]}),t.jsxs(Se,{children:[t.jsx(j,{onClick:()=>S(!1),children:"취소"}),t.jsx(j,{onClick:ae,variant:"contained",children:"저장"})]})]})]})};export{Ye as default};
