import React, { useState } from "react";
import {
  Box,
  Card,
  CardContent,
  Typography,
  Button,
  Grid,
  Chip,
  IconButton,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  TextField,
  MenuItem,
  LinearProgress,
  useTheme,
  List,
  ListItem,
  ListItemText,
  ListItemIcon,
  Checkbox,
  Divider,
  Tooltip,
  Container,
  useMediaQuery,
  Slide,
  Fade,
  FormControl,
  InputLabel,
  Select,
} from "@mui/material";
import {
  Add,
  Edit,
  Delete,
  Assignment,
  CheckCircle,
  Flag,
  ExpandMore,
  Explore,
  PlayArrow,
  Pause,
  AccessTime,
  AddCircleOutline,
} from "@mui/icons-material";
import { Project, ProjectStatus, Priority, Todo, ThemeConfigExtended } from "../types";
import dayjs from "dayjs";
import { useTodo } from "../contexts/TodoContext";
import { DragDropContext, Droppable, Draggable, DropResult } from "react-beautiful-dnd";

interface ProjectManagerProps {
  themeConfig?: ThemeConfigExtended;
}

const ProjectManager: React.FC<ProjectManagerProps> = ({ themeConfig }) => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down("md"));

  // TodoContext ÏÇ¨Ïö©
  const {
    projects,
    todos,
    epics,
    addProject,
    updateProject,
    deleteProject,
    addTodo,
    updateTodo,
    deleteTodo,
    toggleTodoComplete,
    getTodosByProjectId,
    getEpicById,
  } = useTodo();

  // ÏÉÅÌÉú Í¥ÄÎ¶¨
  const [projectDialogOpen, setProjectDialogOpen] = useState(false);
  const [todoDialogOpen, setTodoDialogOpen] = useState(false);
  const [editingProject, setEditingProject] = useState<Project | null>(null);
  const [editingTodo, setEditingTodo] = useState<Todo | null>(null);
  const [selectedProjectId, setSelectedProjectId] = useState<string>("");
  const [viewMode, setViewMode] = useState<"kanban" | "cards">("kanban"); // Î∑∞ Î™®Îìú ÏÑ†ÌÉù

  // ÌîÑÎ°úÏ†ùÌä∏ Ìèº ÏÉÅÌÉú
  const [projectTitle, setProjectTitle] = useState("");
  const [projectDescription, setProjectDescription] = useState("");
  const [projectStatus, setProjectStatus] = useState<ProjectStatus>("active");
  const [projectPriority, setProjectPriority] = useState<Priority>("medium");
  const [projectDueDate, setProjectDueDate] = useState("");
  const [projectEpicId, setProjectEpicId] = useState<string>(""); // ÏóêÌîΩ Ïó∞Í≤∞

  // Ìï†Ïùº Ìèº ÏÉÅÌÉú
  const [todoTitle, setTodoTitle] = useState("");
  const [todoDescription, setTodoDescription] = useState("");
  const [todoPriority, setTodoPriority] = useState<Priority>("medium");
  const [todoDueDate, setTodoDueDate] = useState("");

  // ÏÉÅÌÉúÎ≥Ñ Ïª¨Îüº Ï†ïÏùò
  const statusColumns: { status: ProjectStatus; title: string; color: string; emoji: string }[] = [
    { status: "planning", title: "Í≥ÑÌöç Ï§ë", color: theme.palette.secondary.main, emoji: "üßä" },
    { status: "active", title: "ÏßÑÌñâ Ï§ë", color: theme.palette.success.main, emoji: "üêß" },
    { status: "paused", title: "ÏùºÏãú Ï§ëÎã®", color: theme.palette.warning.main, emoji: "‚ùÑÔ∏è" },
    { status: "completed", title: "ÏôÑÎ£å", color: theme.palette.info.main, emoji: "üêü" },
  ];

  // ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä/ÏàòÏ†ï
  const handleProjectSubmit = () => {
    if (!projectTitle.trim()) return;

    const projectData = {
      title: projectTitle.trim(),
      description: projectDescription.trim(),
      status: projectStatus,
      priority: projectPriority,
      startDate: dayjs().toISOString(),
      dueDate: projectDueDate || undefined,
      progress: editingProject?.progress || 0,
      tags: [],
      epicId: projectEpicId || undefined, // ÏóêÌîΩ Ïó∞Í≤∞
    };

    if (editingProject) {
      updateProject({
        ...editingProject,
        ...projectData,
      });
    } else {
      addProject(projectData, projectEpicId || undefined);
    }

    resetProjectForm();
  };

  // Ìï†Ïùº Ï∂îÍ∞Ä/ÏàòÏ†ï
  const handleTodoSubmit = () => {
    if (!todoTitle.trim()) return;

    const todoData = {
      title: todoTitle.trim(),
      description: todoDescription.trim(),
      completed: editingTodo?.completed || false,
      priority: todoPriority,
      dueDate: todoDueDate || undefined,
      tags: [],
      projectId: selectedProjectId || undefined,
    };

    if (editingTodo) {
      updateTodo({
        ...editingTodo,
        ...todoData,
      });
    } else {
      addTodo(todoData);
    }

    resetTodoForm();
  };

  // Ìèº Ï¥àÍ∏∞Ìôî
  const resetProjectForm = () => {
    setProjectTitle("");
    setProjectDescription("");
    setProjectStatus("active");
    setProjectPriority("medium");
    setProjectDueDate("");
    setProjectEpicId("");
    setEditingProject(null);
    setProjectDialogOpen(false);
  };

  const resetTodoForm = () => {
    setTodoTitle("");
    setTodoDescription("");
    setTodoPriority("medium");
    setTodoDueDate("");
    setEditingTodo(null);
    setSelectedProjectId("");
    setTodoDialogOpen(false);
  };

  // Ìé∏Ïßë Î™®Îìú ÏãúÏûë
  const startEditProject = (project: Project) => {
    setEditingProject(project);
    setProjectTitle(project.title);
    setProjectDescription(project.description);
    setProjectStatus(project.status);
    setProjectPriority(project.priority);
    setProjectDueDate(project.dueDate ? dayjs(project.dueDate).format("YYYY-MM-DD") : "");
    setProjectEpicId(project.epicId || "");
    setProjectDialogOpen(true);
  };

  const startEditTodo = (todo: Todo) => {
    setEditingTodo(todo);
    setTodoTitle(todo.title);
    setTodoDescription(todo.description || "");
    setTodoPriority(todo.priority);
    setTodoDueDate(todo.dueDate ? dayjs(todo.dueDate).format("YYYY-MM-DD") : "");
    setSelectedProjectId(todo.projectId || "");
    setTodoDialogOpen(true);
  };

  const startAddTodo = (projectId: string) => {
    setSelectedProjectId(projectId);
    setTodoDialogOpen(true);
  };

  // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ìï∏Îì§Îü¨
  const handleDragEnd = (result: DropResult) => {
    const { destination, source, draggableId } = result;

    if (!destination) return;
    if (destination.droppableId === source.droppableId && destination.index === source.index) return;

    const project = projects.find((p) => p.id === draggableId);
    if (!project) return;

    const newStatus = destination.droppableId as ProjectStatus;
    updateProject({
      ...project,
      status: newStatus,
    });
  };

  // ÏÉÅÌÉúÎ≥Ñ ÏÉâÏÉÅ
  const getStatusColor = (status: ProjectStatus) => {
    switch (status) {
      case "active":
        return theme.palette.success.main;
      case "completed":
        return theme.palette.info.main;
      case "paused":
        return theme.palette.warning.main;
      case "planning":
        return theme.palette.secondary.main;
      default:
        return theme.palette.grey[500];
    }
  };

  const getStatusLabel = (status: ProjectStatus) => {
    switch (status) {
      case "active":
        return "ÏßÑÌñâÏ§ë";
      case "completed":
        return "ÏôÑÎ£å";
      case "paused":
        return "ÏùºÏãúÏ†ïÏßÄ";
      case "planning":
        return "Í≥ÑÌöçÏ§ë";
      default:
        return status;
    }
  };

  const getProjectsByStatus = (status: ProjectStatus) => {
    return projects.filter((p) => p.status === status);
  };

  // ÌîÑÎ°úÏ†ùÌä∏ Ïπ¥Îìú Î†åÎçîÎßÅ
  const renderProjectCard = (project: Project, index?: number) => {
    const projectTodos = getTodosByProjectId(project.id);
    const completedTodos = projectTodos.filter((t) => t.completed).length;
    const epic = getEpicById(project.epicId || "");

    return (
      <Card sx={{ borderRadius: 2, mb: 2 }} key={project.id}>
        <CardContent>
          {/* ÌîÑÎ°úÏ†ùÌä∏ Ìó§Îçî */}
          <Box display="flex" justifyContent="space-between" alignItems="flex-start" mb={2}>
            <Box flex={1}>
              <Typography variant="h6" fontWeight="bold" gutterBottom>
                {project.title}
              </Typography>
              {epic && (
                <Chip
                  size="small"
                  label={`${epic.emoji} ${epic.title}`}
                  sx={{
                    fontSize: "0.7rem",
                    backgroundColor: epic.color + "20",
                    color: epic.color,
                    border: `1px solid ${epic.color}40`,
                    mb: 1,
                    borderRadius: 2,
                  }}
                />
              )}
            </Box>
            <Box display="flex" gap={0.5}>
              <Tooltip title="ÏàòÏ†ï">
                <IconButton size="small" onClick={() => startEditProject(project)}>
                  <Edit fontSize="small" />
                </IconButton>
              </Tooltip>
              <Tooltip title="ÏÇ≠Ï†ú">
                <IconButton size="small" color="error" onClick={() => deleteProject(project.id)}>
                  <Delete fontSize="small" />
                </IconButton>
              </Tooltip>
            </Box>
          </Box>

          {/* ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥ */}
          <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
            {project.description}
          </Typography>

          <Box display="flex" gap={1} mb={2}>
            <Chip
              size="small"
              label={getStatusLabel(project.status)}
              sx={{
                backgroundColor: getStatusColor(project.status) + "20",
                color: getStatusColor(project.status),
                borderRadius: 2,
              }}
            />
            <Chip
              size="small"
              label={
                project.priority === "urgent"
                  ? "Í∏¥Í∏â"
                  : project.priority === "high"
                  ? "ÎÜíÏùå"
                  : project.priority === "medium"
                  ? "Î≥¥ÌÜµ"
                  : "ÎÇÆÏùå"
              }
              color={
                project.priority === "urgent"
                  ? "error"
                  : project.priority === "high"
                  ? "warning"
                  : project.priority === "medium"
                  ? "primary"
                  : "success"
              }
              sx={{ borderRadius: 2 }}
            />
          </Box>

          {/* ÏßÑÌñâÎ•† */}
          <Box mb={2}>
            <Box display="flex" justifyContent="space-between" alignItems="center" mb={1}>
              <Typography variant="body2">ÏßÑÌñâÎ•†</Typography>
              <Typography variant="body2">{Math.round(project.progress)}%</Typography>
            </Box>
            <LinearProgress variant="determinate" value={project.progress} sx={{ height: 8, borderRadius: 2 }} />
          </Box>

          <Divider sx={{ my: 2 }} />

          {/* Ìï†Ïùº Î™©Î°ù */}
          <Box display="flex" justifyContent="space-between" alignItems="center" mb={1}>
            <Typography variant="subtitle2">
              Ìï†Ïùº ({projectTodos.length}) - ÏôÑÎ£å ({completedTodos})
            </Typography>
            <Tooltip title="Ìï†Ïùº Ï∂îÍ∞Ä">
              <IconButton size="small" onClick={() => startAddTodo(project.id)}>
                <Add fontSize="small" />
              </IconButton>
            </Tooltip>
          </Box>

          <List dense sx={{ maxHeight: 200, overflow: "auto" }}>
            {projectTodos.length === 0 ? (
              <ListItem>
                <ListItemText
                  primary={
                    <Typography variant="body2" color="text.secondary" textAlign="center">
                      Ìï†ÏùºÏù¥ ÏóÜÏñ¥Ïöî. Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî! ‚ú®
                    </Typography>
                  }
                />
              </ListItem>
            ) : (
              projectTodos.slice(0, 5).map((todo) => (
                <ListItem key={todo.id} sx={{ px: 0 }}>
                  <ListItemIcon sx={{ minWidth: 32 }}>
                    <Checkbox size="small" checked={todo.completed} onChange={() => toggleTodoComplete(todo.id)} />
                  </ListItemIcon>
                  <ListItemText
                    primary={
                      <Typography
                        variant="body2"
                        sx={{
                          textDecoration: todo.completed ? "line-through" : "none",
                          opacity: todo.completed ? 0.7 : 1,
                        }}
                      >
                        {todo.title}
                      </Typography>
                    }
                  />
                  <Box display="flex" gap={0.5}>
                    <Tooltip title="ÏàòÏ†ï">
                      <IconButton size="small" onClick={() => startEditTodo(todo)}>
                        <Edit fontSize="small" />
                      </IconButton>
                    </Tooltip>
                    <Tooltip title="ÏÇ≠Ï†ú">
                      <IconButton size="small" color="error" onClick={() => deleteTodo(todo.id)}>
                        <Delete fontSize="small" />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </ListItem>
              ))
            )}
          </List>

          {projectTodos.length > 5 && (
            <Typography variant="caption" color="text.secondary" sx={{ mt: 1, display: "block" }}>
              +{projectTodos.length - 5}Í∞ú Îçî...
            </Typography>
          )}
        </CardContent>
      </Card>
    );
  };

  return (
    <Container maxWidth="xl">
      <Box py={3}>
        {/* Ìó§Îçî */}
        <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
          <Typography variant="h4" component="h1">
            {themeConfig?.concepts?.projectType || "üöÄ ÌîÑÎ°úÏ†ùÌä∏"} Í¥ÄÎ¶¨
          </Typography>
          <Box display="flex" gap={2} alignItems="center">
            {/* Î∑∞ Î™®Îìú ÏÑ†ÌÉù */}
            <FormControl size="small">
              <InputLabel>Î∑∞ Î™®Îìú</InputLabel>
              <Select
                value={viewMode}
                label="Î∑∞ Î™®Îìú"
                onChange={(e) => setViewMode(e.target.value as "kanban" | "cards")}
              >
                <MenuItem value="kanban">üìã Ïπ∏Î∞ò Î≥¥Îìú</MenuItem>
                <MenuItem value="cards">üÉè Ïπ¥Îìú Î∑∞</MenuItem>
              </Select>
            </FormControl>
            <Button variant="contained" startIcon={<Add />} onClick={() => setProjectDialogOpen(true)}>
              ÏÉà ÌîÑÎ°úÏ†ùÌä∏
            </Button>
          </Box>
        </Box>

        {/* Ïπ∏Î∞ò Î≥¥Îìú Î∑∞ */}
        {viewMode === "kanban" ? (
          <DragDropContext onDragEnd={handleDragEnd}>
            <Box>
              <Typography variant="h6" fontWeight="bold" sx={{ mb: 3, display: "flex", alignItems: "center", gap: 1 }}>
                <Explore color="primary" />
                ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô©Ìåê
              </Typography>
              <Box sx={{ overflowX: "auto", pb: 2 }}>
                <Box sx={{ display: "flex", gap: 3, minWidth: "fit-content" }}>
                  {statusColumns.map((column) => (
                    <Box key={column.status} sx={{ minWidth: 320, maxWidth: 400 }}>
                      {/* Ïª¨Îüº Ìó§Îçî */}
                      <Box
                        sx={{
                          p: 3,
                          mb: 3,
                          background: `linear-gradient(135deg, ${column.color}15 0%, ${column.color}25 100%)`,
                          borderRadius: 2,
                          border: `2px solid ${column.color}30`,
                          boxShadow: `0 4px 20px ${column.color}20`,
                        }}
                      >
                        <Box sx={{ display: "flex", alignItems: "center", gap: 2 }}>
                          <Typography sx={{ fontSize: "1.8rem" }}>{column.emoji}</Typography>
                          <Typography variant="h6" fontWeight="bold">
                            {column.title}
                          </Typography>
                          <Chip
                            label={getProjectsByStatus(column.status).length}
                            size="small"
                            sx={{
                              backgroundColor: column.color,
                              color: "white",
                              fontWeight: "bold",
                              ml: "auto",
                            }}
                          />
                        </Box>
                      </Box>

                      {/* ÎìúÎ°≠ Í∞ÄÎä•Ìïú ÏòÅÏó≠ */}
                      <Droppable droppableId={column.status}>
                        {(provided, snapshot) => (
                          <Box
                            ref={provided.innerRef}
                            {...provided.droppableProps}
                            sx={{
                              display: "flex",
                              flexDirection: "column",
                              gap: 2,
                              minHeight: 200,
                              backgroundColor: snapshot.isDraggingOver ? `${column.color}10` : "transparent",
                              borderRadius: 2,
                              p: 1,
                              transition: "background-color 0.2s ease",
                            }}
                          >
                            {getProjectsByStatus(column.status).map((project, index) => (
                              <Draggable key={project.id} draggableId={project.id} index={index}>
                                {(provided, snapshot) => (
                                  <div
                                    ref={provided.innerRef}
                                    {...provided.draggableProps}
                                    {...provided.dragHandleProps}
                                  >
                                    <Slide key={project.id} direction="up" in={true} timeout={500}>
                                      <Box
                                        sx={{
                                          transform: snapshot.isDragging ? "rotate(5deg)" : "none",
                                          transition: "all 0.3s ease",
                                        }}
                                      >
                                        {renderProjectCard(project, index)}
                                      </Box>
                                    </Slide>
                                  </div>
                                )}
                              </Draggable>
                            ))}
                            {provided.placeholder}
                            {getProjectsByStatus(column.status).length === 0 && (
                              <Box
                                sx={{
                                  textAlign: "center",
                                  py: 6,
                                  borderRadius: 2,
                                  border: `2px dashed ${column.color}40`,
                                  backgroundColor: `${column.color}08`,
                                }}
                              >
                                <Typography color="textSecondary" sx={{ fontSize: "1.1rem" }}>
                                  {column.emoji}
                                </Typography>
                                <Typography color="textSecondary" sx={{ mt: 1 }}>
                                  {column.title} ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§
                                </Typography>
                              </Box>
                            )}
                          </Box>
                        )}
                      </Droppable>
                    </Box>
                  ))}
                </Box>
              </Box>
            </Box>
          </DragDropContext>
        ) : (
          /* Ïπ¥Îìú Î∑∞ */
          <Grid container spacing={3}>
            {projects.length === 0 ? (
              <Grid item xs={12}>
                <Card sx={{ borderRadius: 2 }}>
                  <CardContent sx={{ textAlign: "center", py: 6 }}>
                    <Typography variant="h6" color="text.secondary" gutterBottom>
                      ÏïÑÏßÅ ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏñ¥Ïöî! üöÄ
                    </Typography>
                    <Typography variant="body2" color="text.secondary" sx={{ mb: 3 }}>
                      ÏÉàÎ°úÏö¥ ÌîÑÎ°úÏ†ùÌä∏Î•º ÎßåÎì§Ïñ¥ÏÑú Ìï†ÏùºÏùÑ Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú Í¥ÄÎ¶¨Ìï¥Î≥¥ÏÑ∏Ïöî!
                    </Typography>
                    <Button variant="contained" startIcon={<Add />} onClick={() => setProjectDialogOpen(true)}>
                      Ï≤´ Î≤àÏß∏ ÌîÑÎ°úÏ†ùÌä∏ ÎßåÎì§Í∏∞
                    </Button>
                  </CardContent>
                </Card>
              </Grid>
            ) : (
              projects.map((project) => (
                <Grid item xs={12} md={6} lg={4} key={project.id}>
                  {renderProjectCard(project)}
                </Grid>
              ))
            )}
          </Grid>
        )}

        {/* ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä/ÏàòÏ†ï Îã§Ïù¥ÏñºÎ°úÍ∑∏ */}
        <Dialog open={projectDialogOpen} onClose={resetProjectForm} maxWidth="sm" fullWidth>
          <DialogTitle>{editingProject ? "ÌîÑÎ°úÏ†ùÌä∏ ÏàòÏ†ï" : "ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä"} üöÄ</DialogTitle>
          <DialogContent>
            <TextField
              autoFocus
              margin="dense"
              label="ÌîÑÎ°úÏ†ùÌä∏ Ï†úÎ™©"
              fullWidth
              variant="outlined"
              value={projectTitle}
              onChange={(e) => setProjectTitle(e.target.value)}
              sx={{ mb: 2 }}
            />
            <TextField
              margin="dense"
              label="ÏÑ§Î™Ö"
              fullWidth
              variant="outlined"
              multiline
              rows={3}
              value={projectDescription}
              onChange={(e) => setProjectDescription(e.target.value)}
              sx={{ mb: 2 }}
            />

            {/* ÏóêÌîΩ ÏÑ†ÌÉù */}
            <TextField
              select
              margin="dense"
              label="ÏóêÌîΩ Ïó∞Í≤∞ (ÏÑ†ÌÉùÏÇ¨Ìï≠)"
              fullWidth
              variant="outlined"
              value={projectEpicId}
              onChange={(e) => setProjectEpicId(e.target.value)}
              sx={{ mb: 2 }}
            >
              <MenuItem value="">ÏóêÌîΩ ÏóÜÏùå</MenuItem>
              {epics.map((epic) => (
                <MenuItem key={epic.id} value={epic.id}>
                  {epic.emoji} {epic.title}
                </MenuItem>
              ))}
            </TextField>

            <Grid container spacing={2}>
              <Grid item xs={6}>
                <TextField
                  select
                  margin="dense"
                  label="ÏÉÅÌÉú"
                  fullWidth
                  variant="outlined"
                  value={projectStatus}
                  onChange={(e) => setProjectStatus(e.target.value as ProjectStatus)}
                >
                  <MenuItem value="planning">Í≥ÑÌöçÏ§ë</MenuItem>
                  <MenuItem value="active">ÏßÑÌñâÏ§ë</MenuItem>
                  <MenuItem value="paused">ÏùºÏãúÏ†ïÏßÄ</MenuItem>
                  <MenuItem value="completed">ÏôÑÎ£å</MenuItem>
                </TextField>
              </Grid>
              <Grid item xs={6}>
                <TextField
                  select
                  margin="dense"
                  label="Ïö∞ÏÑ†ÏàúÏúÑ"
                  fullWidth
                  variant="outlined"
                  value={projectPriority}
                  onChange={(e) => setProjectPriority(e.target.value as Priority)}
                >
                  <MenuItem value="low">ÎÇÆÏùå</MenuItem>
                  <MenuItem value="medium">Î≥¥ÌÜµ</MenuItem>
                  <MenuItem value="high">ÎÜíÏùå</MenuItem>
                  <MenuItem value="urgent">Í∏¥Í∏â</MenuItem>
                </TextField>
              </Grid>
            </Grid>
            <TextField
              type="date"
              margin="dense"
              label="ÎßàÍ∞êÏùº"
              fullWidth
              variant="outlined"
              value={projectDueDate}
              onChange={(e) => setProjectDueDate(e.target.value)}
              InputLabelProps={{ shrink: true }}
              sx={{ mt: 2 }}
            />
          </DialogContent>
          <DialogActions>
            <Button onClick={resetProjectForm}>Ï∑®ÏÜå</Button>
            <Button onClick={handleProjectSubmit} variant="contained" disabled={!projectTitle.trim()}>
              {editingProject ? "ÏàòÏ†ï" : "Ï∂îÍ∞Ä"}
            </Button>
          </DialogActions>
        </Dialog>

        {/* Ìï†Ïùº Ï∂îÍ∞Ä/ÏàòÏ†ï Îã§Ïù¥ÏñºÎ°úÍ∑∏ */}
        <Dialog open={todoDialogOpen} onClose={resetTodoForm} maxWidth="sm" fullWidth>
          <DialogTitle>{editingTodo ? "Ìï†Ïùº ÏàòÏ†ï" : "ÏÉà Ìï†Ïùº Ï∂îÍ∞Ä"} üìù</DialogTitle>
          <DialogContent>
            <TextField
              autoFocus
              margin="dense"
              label="Ìï†Ïùº Ï†úÎ™©"
              fullWidth
              variant="outlined"
              value={todoTitle}
              onChange={(e) => setTodoTitle(e.target.value)}
              sx={{ mb: 2 }}
            />
            <TextField
              margin="dense"
              label="ÏÑ§Î™Ö"
              fullWidth
              variant="outlined"
              multiline
              rows={2}
              value={todoDescription}
              onChange={(e) => setTodoDescription(e.target.value)}
              sx={{ mb: 2 }}
            />
            <Grid container spacing={2}>
              <Grid item xs={6}>
                <TextField
                  select
                  margin="dense"
                  label="ÌîÑÎ°úÏ†ùÌä∏"
                  fullWidth
                  variant="outlined"
                  value={selectedProjectId}
                  onChange={(e) => setSelectedProjectId(e.target.value)}
                >
                  <MenuItem value="">ÌîÑÎ°úÏ†ùÌä∏ ÏóÜÏùå</MenuItem>
                  {projects.map((project) => (
                    <MenuItem key={project.id} value={project.id}>
                      {project.title}
                    </MenuItem>
                  ))}
                </TextField>
              </Grid>
              <Grid item xs={6}>
                <TextField
                  select
                  margin="dense"
                  label="Ïö∞ÏÑ†ÏàúÏúÑ"
                  fullWidth
                  variant="outlined"
                  value={todoPriority}
                  onChange={(e) => setTodoPriority(e.target.value as Priority)}
                >
                  <MenuItem value="low">ÎÇÆÏùå</MenuItem>
                  <MenuItem value="medium">Î≥¥ÌÜµ</MenuItem>
                  <MenuItem value="high">ÎÜíÏùå</MenuItem>
                  <MenuItem value="urgent">Í∏¥Í∏â</MenuItem>
                </TextField>
              </Grid>
            </Grid>
            <TextField
              type="date"
              margin="dense"
              label="ÎßàÍ∞êÏùº"
              fullWidth
              variant="outlined"
              value={todoDueDate}
              onChange={(e) => setTodoDueDate(e.target.value)}
              InputLabelProps={{ shrink: true }}
              sx={{ mt: 2 }}
            />
          </DialogContent>
          <DialogActions>
            <Button onClick={resetTodoForm}>Ï∑®ÏÜå</Button>
            <Button onClick={handleTodoSubmit} variant="contained" disabled={!todoTitle.trim()}>
              {editingTodo ? "ÏàòÏ†ï" : "Ï∂îÍ∞Ä"}
            </Button>
          </DialogActions>
        </Dialog>
      </Box>
    </Container>
  );
};

export default ProjectManager;
